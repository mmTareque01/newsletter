"use strict";var bn=Object.create;var dt=Object.defineProperty;var xn=Object.getOwnPropertyDescriptor;var Sn=Object.getOwnPropertyNames;var Rn=Object.getPrototypeOf,Tn=Object.prototype.hasOwnProperty;var On=(e,t)=>{for(var r in t)dt(e,r,{get:t[r],enumerable:!0})},Zr=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Sn(t))!Tn.call(e,n)&&n!==r&&dt(e,n,{get:()=>t[n],enumerable:!(o=xn(t,n))||o.enumerable});return e};var h=(e,t,r)=>(r=e!=null?bn(Rn(e)):{},Zr(t||!e||!e.__esModule?dt(r,"default",{value:e,enumerable:!0}):r,e)),Pn=e=>Zr(dt({},"__esModule",{value:!0}),e);var yi={};On(yi,{BuiltinLogger:()=>Fe,DependsOnMethod:()=>qe,Documentation:()=>Zt,DocumentationError:()=>q,EndpointsFactory:()=>he,EventStreamFactory:()=>Dt,InputValidationError:()=>X,Integration:()=>Ht,Middleware:()=>V,MissingPeerError:()=>Ce,OutputValidationError:()=>pe,ResultHandler:()=>ye,RoutingError:()=>ae,ServeStatic:()=>$e,arrayEndpointsFactory:()=>Yr,arrayResultHandler:()=>Pt,attachRouting:()=>ko,createConfig:()=>vr,createServer:()=>Co,defaultEndpointsFactory:()=>Wr,defaultResultHandler:()=>ge,ensureHttpError:()=>Ee,ez:()=>hn,getExamples:()=>ne,getMessageFromError:()=>de,testEndpoint:()=>sn,testMiddleware:()=>an});module.exports=Pn(yi);var D=h(require("ramda"),1),Pe=require("zod");var H=h(require("ramda"),1),$t=require("zod");var I={json:"application/json",upload:"multipart/form-data",raw:"application/octet-stream",sse:"text/event-stream",form:"application/x-www-form-urlencoded"};var ae=class extends Error{name="RoutingError";cause;constructor(t,r,o){super(t),this.cause={method:r,path:o}}},q=class extends Error{name="DocumentationError";cause;constructor(t,{method:r,path:o,isResponse:n}){super(t),this.cause=`${n?"Response":"Input"} schema of an Endpoint assigned to ${r.toUpperCase()} method of ${o} path.`}},mt=class extends Error{name="IOSchemaError"},pe=class extends mt{constructor(r){super(de(r),{cause:r});this.cause=r}name="OutputValidationError"},X=class extends mt{constructor(r){super(de(r),{cause:r});this.cause=r}name="InputValidationError"},ce=class extends Error{constructor(r,o){super(de(r),{cause:r});this.cause=r;this.handled=o}name="ResultHandlerError"},Ce=class extends Error{name="MissingPeerError";constructor(t){super(`Missing peer dependency: ${t}. Please install it to use the feature.`)}};var _t=/:([A-Za-z0-9_]+)/g,lt=e=>e.match(_t)?.map(t=>t.slice(1))||[],wn=e=>{let r=(e.header("content-type")||"").toLowerCase().startsWith(I.upload);return"files"in e&&r},Vt={get:["query","params"],post:["body","params","files"],put:["body","params"],patch:["body","params"],delete:["query","params"]},An=["body","query","params"],Gt=e=>e.method.toLowerCase(),ut=(e,t={})=>{let r=Gt(e);return r==="options"?{}:(t[r]||Vt[r]||An).filter(o=>o==="files"?wn(e):!0).reduce((o,n)=>Object.assign(o,e[n]),{})},me=e=>e instanceof Error?e:new Error(String(e)),de=e=>e instanceof $t.z.ZodError?e.issues.map(({path:t,message:r})=>(t.length?[t.join("/")]:[]).concat(r).join(": ")).join("; "):e instanceof pe?`output${e.cause.issues[0]?.path.length>0?"/":": "}${e.message}`:e.message,En=e=>Object.entries(e.shape).reduce((t,[r,o])=>{let{_def:n}=o;return Re(t,(n[y]?.examples||[]).map(H.objOf(r)),([s,a])=>({...s,...a}))},[]),ne=({schema:e,variant:t="original",validate:r=t==="parsed",pullProps:o=!1})=>{let n=e._def[y]?.examples||[];if(!n.length&&o&&e instanceof $t.z.ZodObject&&(n=En(e)),!r&&t==="original")return n;let s=[];for(let a of n){let c=e.safeParse(a);c.success&&s.push(t==="parsed"?c.data:a)}return s},Re=(e,t,r)=>e.length&&t.length?H.xprod(e,t).map(r):e.concat(t),Jt=e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase(),le=(...e)=>{let t=H.chain(o=>o.split(/[^A-Z0-9]/gi),e);return H.chain(o=>o.replaceAll(/[A-Z]+/g,n=>`/${n}`).split("/"),t).map(Jt).join("")},ft=H.tryCatch((e,t)=>typeof e.parse(t),H.always(void 0)),Te=e=>typeof e=="object"&&e!==null,Oe=H.memoizeWith(()=>"static",()=>process.env.NODE_ENV==="production");var yt=h(require("ramda"),1),y=Symbol.for("express-zod-api"),We=e=>{let t=e.describe(e.description);return t._def[y]=yt.clone(t._def[y])||{examples:[]},t},Ir=(e,t)=>{if(!(y in e._def))return t;let r=We(t);return r._def[y].examples=Re(r._def[y].examples,e._def[y].examples,([o,n])=>typeof o=="object"&&typeof n=="object"?yt.mergeDeepRight({...o},{...n}):n),r};var zn=function(e){let t=We(this);return t._def[y].examples.push(e),t},Zn=function(){let e=We(this);return e._def[y].isDeprecated=!0,e},In=function(e){let t=We(this);return t._def[y].defaultLabel=e,t},vn=function(e){return new Pe.z.ZodBranded({typeName:Pe.z.ZodFirstPartyTypeKind.ZodBranded,type:this,description:this._def.description,errorMap:this._def.errorMap,[y]:{examples:[],...D.clone(this._def[y]),brand:e}})},kn=function(e){let t=typeof e=="function"?e:D.pipe(D.toPairs,D.map(([n,s])=>D.pair(e[String(n)]||n,s)),D.fromPairs),r=t(D.clone(this.shape)),o=Pe.z.object(r)[this._def.unknownKeys]();return this.transform(t).pipe(o)};y in globalThis||(globalThis[y]=!0,Object.defineProperties(Pe.z.ZodType.prototype,{example:{get(){return zn.bind(this)}},deprecated:{get(){return Zn.bind(this)}},brand:{set(){},get(){return vn.bind(this)}}}),Object.defineProperty(Pe.z.ZodDefault.prototype,"label",{get(){return In.bind(this)}}),Object.defineProperty(Pe.z.ZodObject.prototype,"remap",{get(){return kn.bind(this)}}));function vr(e){return e}var rr=require("zod");var Ue=h(require("ramda"),1),er=require("zod");var N=require("node:assert/strict");var je=require("zod");var gt=e=>!isNaN(e.getTime());var we=Symbol("DateIn"),kr=()=>je.z.union([je.z.string().date(),je.z.string().datetime(),je.z.string().datetime({local:!0})]).transform(t=>new Date(t)).pipe(je.z.date().refine(gt)).brand(we);var Cr=require("zod");var Ae=Symbol("DateOut"),jr=()=>Cr.z.date().refine(gt).transform(e=>e.toISOString()).brand(Ae);var Ye=require("zod"),ee=Symbol("File"),Nr=Ye.z.custom(e=>Buffer.isBuffer(e),{message:"Expected Buffer"}),Cn={buffer:()=>Nr.brand(ee),string:()=>Ye.z.string().brand(ee),binary:()=>Nr.or(Ye.z.string()).brand(ee),base64:()=>Ye.z.string().base64().brand(ee)};function ht(e){return Cn[e||"string"]()}var Wt=require("zod"),bt=Symbol("Form"),Mr=e=>(e instanceof Wt.z.ZodObject?e:Wt.z.object(e)).brand(bt);var Ur=require("zod");var ue=Symbol("Raw"),Lr=Ur.z.object({raw:ht("buffer")});function Hr(e){return(e?Lr.extend(e):Lr).brand(ue)}var Dr=require("zod"),Ne=Symbol("Upload"),Kr=()=>Dr.z.custom(e=>typeof e=="object"&&e!==null&&"name"in e&&"encoding"in e&&"mimetype"in e&&"data"in e&&"tempFilePath"in e&&"truncated"in e&&"size"in e&&"md5"in e&&"mv"in e&&typeof e.name=="string"&&typeof e.encoding=="string"&&typeof e.mimetype=="string"&&Buffer.isBuffer(e.data)&&typeof e.tempFilePath=="string"&&typeof e.truncated=="boolean"&&typeof e.size=="number"&&typeof e.md5=="string"&&typeof e.mv=="function",e=>({message:`Expected file upload, received ${typeof e}`})).brand(Ne);var Fr=(e,{next:t})=>e.options.some(t),jn=({_def:e},{next:t})=>[e.left,e.right].some(t),xt=(e,{next:t})=>t(e.unwrap()),St={ZodObject:({shape:e},{next:t})=>Object.values(e).some(t),ZodUnion:Fr,ZodDiscriminatedUnion:Fr,ZodIntersection:jn,ZodEffects:(e,{next:t})=>t(e.innerType()),ZodOptional:xt,ZodNullable:xt,ZodRecord:({valueSchema:e},{next:t})=>t(e),ZodArray:({element:e},{next:t})=>t(e),ZodDefault:({_def:e},{next:t})=>t(e.innerType)},Qe=(e,{condition:t,rules:r=St,depth:o=1,maxDepth:n=Number.POSITIVE_INFINITY})=>{if(t?.(e))return!0;let s=o<n?r[e._def[y]?.brand]||"typeName"in e._def&&r[e._def.typeName]:void 0;return s?s(e,{next:a=>Qe(a,{condition:t,rules:r,maxDepth:n,depth:o+1})}):!1},qr=e=>Qe(e,{condition:t=>t._def[y]?.brand===Ne,rules:{...St,[bt]:(t,{next:r})=>Object.values(t.unwrap().shape).some(r)}}),Br=e=>Qe(e,{condition:t=>t._def[y]?.brand===ue,maxDepth:3}),$r=e=>Qe(e,{condition:t=>t._def[y]?.brand===bt,maxDepth:3}),_r=(e,t)=>{let r=new WeakSet;return Qe(e,{maxDepth:300,rules:{...St,ZodBranded:xt,ZodReadonly:xt,ZodCatch:({_def:{innerType:o}},{next:n})=>n(o),ZodPipeline:({_def:o},{next:n})=>n(o[t]),ZodLazy:(o,{next:n})=>r.has(o)?!1:r.add(o)&&n(o.schema),ZodTuple:({items:o,_def:{rest:n}},{next:s})=>[...o].concat(n??[]).some(s),ZodEffects:{out:void 0,in:St.ZodEffects}[t],ZodNaN:()=>(0,N.fail)("z.nan()"),ZodSymbol:()=>(0,N.fail)("z.symbol()"),ZodFunction:()=>(0,N.fail)("z.function()"),ZodMap:()=>(0,N.fail)("z.map()"),ZodSet:()=>(0,N.fail)("z.set()"),ZodBigInt:()=>(0,N.fail)("z.bigint()"),ZodVoid:()=>(0,N.fail)("z.void()"),ZodPromise:()=>(0,N.fail)("z.promise()"),ZodNever:()=>(0,N.fail)("z.never()"),ZodDate:()=>t==="in"&&(0,N.fail)("z.date()"),[Ae]:()=>t==="in"&&(0,N.fail)("ez.dateOut()"),[we]:()=>t==="out"&&(0,N.fail)("ez.dateIn()"),[ue]:()=>t==="out"&&(0,N.fail)("ez.raw()"),[Ne]:()=>t==="out"&&(0,N.fail)("ez.upload()"),[ee]:()=>!1}})};var Rt=h(require("http-errors"),1);var Xe=h(require("http-errors"),1),Vr=require("zod");var Yt=(e,{variant:t,args:r,...o})=>{if(typeof e=="function"&&(e=e(...r)),e instanceof Vr.z.ZodType)return[{schema:e,...o}];if(Array.isArray(e)&&!e.length){let n=new Error(`At least one ${t} response schema required.`);throw new ce(n)}return(Array.isArray(e)?e:[e]).map(({schema:n,statusCode:s,mimeType:a})=>({schema:n,statusCodes:typeof s=="number"?[s]:s||o.statusCodes,mimeTypes:typeof a=="string"?[a]:a===void 0?o.mimeTypes:a}))},et=(e,t,{url:r},o)=>!e.expose&&t.error("Server side error",{error:e,url:r,payload:o}),Ee=e=>(0,Xe.isHttpError)(e)?e:(0,Xe.default)(e instanceof X?400:500,de(e),{cause:e.cause||e}),ze=e=>Oe()&&!e.expose?(0,Xe.default)(e.statusCode).message:e.message;var Tt=({error:e,logger:t,response:r})=>{t.error("Result handler failure",e);let o=ze((0,Rt.default)(500,`An error occurred while serving the result: ${e.message}.`+(e.handled?`
Original error: ${e.handled.message}.`:""),{expose:(0,Rt.isHttpError)(e.cause)?e.cause.expose:!1}));r.status(500).type("text/plain").end(o)};var Qt=require("zod");var Xt=class{},V=class extends Xt{#e;#t;#r;constructor({input:t=Qt.z.object({}),security:r,handler:o}){super(),this.#e=t,this.#t=r,this.#r=o}get security(){return this.#t}get schema(){return this.#e}async execute({input:t,...r}){try{let o=await this.#e.parseAsync(t);return this.#r({...r,input:o})}catch(o){throw o instanceof Qt.z.ZodError?new X(o):o}}},Me=class extends V{constructor(t,{provider:r=()=>({}),transformer:o=n=>n}={}){super({handler:async({request:n,response:s})=>new Promise((a,c)=>{let m=p=>{if(p&&p instanceof Error)return c(o(p));a(r(n,s))};t(n,s,m)?.catch(m)})})}};var Le=class{nest(t){return Object.assign(t,{"":this})}};var tt=class extends Le{},Ot=class e extends tt{#e;constructor(t){super(),this.#e=t}#t(t){return new e({...this.#e,...t})}deprecated(){return this.#t({deprecated:!0})}get isDeprecated(){return this.#e.deprecated||!1}get description(){return this.#e.description}get shortDescription(){return this.#e.shortDescription}get methods(){return Object.freeze(this.#e.methods)}get inputSchema(){return this.#e.inputSchema}get outputSchema(){return this.#e.outputSchema}get requestType(){return qr(this.#e.inputSchema)?"upload":Br(this.#e.inputSchema)?"raw":$r(this.#e.inputSchema)?"form":"json"}getResponses(t){return Object.freeze(t==="negative"?this.#e.resultHandler.getNegativeResponse():this.#e.resultHandler.getPositiveResponse(this.#e.outputSchema))}get security(){let t=Ue.pluck("security",this.#e.middlewares||[]);return Ue.reject(Ue.isNil,t)}get scopes(){return Object.freeze(this.#e.scopes||[])}get tags(){return Object.freeze(this.#e.tags||[])}getOperationId(t){return this.#e.getOperationId?.(t)}async#r(t){try{return await this.#e.outputSchema.parseAsync(t)}catch(r){throw r instanceof er.z.ZodError?new pe(r):r}}async#o({method:t,logger:r,options:o,response:n,...s}){for(let a of this.#e.middlewares||[])if(!(t==="options"&&!(a instanceof Me))&&(Object.assign(o,await a.execute({...s,options:o,response:n,logger:r})),n.writableEnded)){r.warn("A middleware has closed the stream. Accumulated options:",o);break}}async#n({input:t,...r}){let o;try{o=await this.#e.inputSchema.parseAsync(t)}catch(n){throw n instanceof er.z.ZodError?new X(n):n}return this.#e.handler({...r,input:o})}async#s({error:t,...r}){try{await this.#e.resultHandler.execute({...r,error:t})}catch(o){Tt({...r,error:new ce(me(o),t||void 0)})}}async execute({request:t,response:r,logger:o,config:n}){let s=Gt(t),a={},c=null,m=null,p=ut(t,n.inputSources);try{if(await this.#o({method:s,input:p,request:t,response:r,logger:o,options:a}),r.writableEnded)return;if(s==="options")return void r.status(200).end();c=await this.#r(await this.#n({input:p,logger:o,options:a}))}catch(l){m=me(l)}await this.#s({input:p,output:c,request:t,response:r,error:m,logger:o,options:a})}};var Gr=h(require("ramda"),1),fe=require("zod");var Jr=(e,t)=>{let r=Gr.pluck("schema",e);r.push(t);let o=r.reduce((n,s)=>n.and(s));return r.reduce((n,s)=>Ir(s,n),o)},G=e=>e instanceof fe.z.ZodObject?e:e instanceof fe.z.ZodBranded?G(e.unwrap()):e instanceof fe.z.ZodUnion||e instanceof fe.z.ZodDiscriminatedUnion?e.options.map(t=>G(t)).reduce((t,r)=>t.merge(r.partial()),fe.z.object({})):e instanceof fe.z.ZodEffects?G(e._def.schema):e instanceof fe.z.ZodPipeline?G(e._def.in):G(e._def.left).merge(G(e._def.right));var J=require("zod");var He={positive:200,negative:400},De=Object.keys(He);var tr=class{#e;constructor(t){this.#e=t}execute(...t){return this.#e(...t)}},ye=class extends tr{#e;#t;constructor(t){super(t.handler),this.#e=t.positive,this.#t=t.negative}getPositiveResponse(t){return Yt(this.#e,{variant:"positive",args:[t],statusCodes:[He.positive],mimeTypes:[I.json]})}getNegativeResponse(){return Yt(this.#t,{variant:"negative",args:[],statusCodes:[He.negative],mimeTypes:[I.json]})}},ge=new ye({positive:e=>{let t=ne({schema:e,pullProps:!0}),r=J.z.object({status:J.z.literal("success"),data:e});return t.reduce((o,n)=>o.example({status:"success",data:n}),r)},negative:J.z.object({status:J.z.literal("error"),error:J.z.object({message:J.z.string()})}).example({status:"error",error:{message:"Sample error message"}}),handler:({error:e,input:t,output:r,request:o,response:n,logger:s})=>{if(e){let a=Ee(e);return et(a,s,o,t),void n.status(a.statusCode).set(a.headers).json({status:"error",error:{message:ze(a)}})}n.status(He.positive).json({status:"success",data:r})}}),Pt=new ye({positive:e=>{let t=ne({schema:e}),r="shape"in e&&"items"in e.shape&&e.shape.items instanceof J.z.ZodArray?e.shape.items:J.z.array(J.z.any());return t.reduce((o,n)=>Te(n)&&"items"in n&&Array.isArray(n.items)?o.example(n.items):o,r)},negative:J.z.string().example("Sample error message"),handler:({response:e,output:t,error:r,logger:o,request:n,input:s})=>{if(r){let a=Ee(r);return et(a,o,n,s),void e.status(a.statusCode).type("text/plain").send(ze(a))}if(t&&"items"in t&&Array.isArray(t.items))return void e.status(He.positive).json(t.items);throw new Error("Property 'items' is missing in the endpoint output")}});var he=class e{constructor(t){this.resultHandler=t}middlewares=[];static#e(t,r){let o=new e(r);return o.middlewares=t,o}addMiddleware(t){return e.#e(this.middlewares.concat(t instanceof V?t:new V(t)),this.resultHandler)}use=this.addExpressMiddleware;addExpressMiddleware(...t){return e.#e(this.middlewares.concat(new Me(...t)),this.resultHandler)}addOptions(t){return e.#e(this.middlewares.concat(new V({handler:t})),this.resultHandler)}build({input:t=rr.z.object({}),output:r,operationId:o,scope:n,tag:s,method:a,...c}){let{middlewares:m,resultHandler:p}=this,l=typeof a=="string"?[a]:a,b=typeof o=="function"?o:()=>o,g=typeof n=="string"?[n]:n||[],R=typeof s=="string"?[s]:s||[];return new Ot({...c,middlewares:m,outputSchema:r,resultHandler:p,scopes:g,tags:R,methods:l,getOperationId:b,inputSchema:Jr(m,t)})}buildVoid({handler:t,...r}){return this.build({...r,output:rr.z.object({}),handler:async o=>(await t(o),{})})}},Wr=new he(ge),Yr=new he(Pt);var oo=h(require("ansis"),1),no=require("node:util"),nr=require("node:perf_hooks");var te=require("ansis"),Qr=h(require("ramda"),1);var or={debug:te.blue,info:te.green,warn:(0,te.hex)("#FFA500"),error:te.red,ctx:te.cyanBright},wt={debug:10,info:20,warn:30,error:40},Xr=e=>Te(e)&&Object.keys(wt).some(t=>t in e),eo=e=>e in wt,to=(e,t)=>wt[e]<wt[t],Nn=(e,t=0)=>Intl.NumberFormat(void 0,{useGrouping:!1,minimumFractionDigits:0,maximumFractionDigits:t,style:"unit",unitDisplay:"long",unit:e}),Ke=Qr.memoizeWith((e,t)=>`${e}${t}`,Nn),ro=e=>e<1e-6?Ke("nanosecond",3).format(e/1e-6):e<.001?Ke("nanosecond").format(e/1e-6):e<1?Ke("microsecond").format(e/.001):e<1e3?Ke("millisecond").format(e):e<6e4?Ke("second",2).format(e/1e3):Ke("minute",2).format(e/6e4);var Fe=class e{config;constructor({color:t=oo.default.isSupported(),level:r=Oe()?"warn":"debug",depth:o=2,ctx:n={}}={}){this.config={color:t,level:r,depth:o,ctx:n}}format(t){let{depth:r,color:o,level:n}=this.config;return(0,no.inspect)(t,{depth:r,colors:o,breakLength:n==="debug"?80:1/0,compact:n==="debug"?3:!0})}print(t,r,o){let{level:n,ctx:{requestId:s,...a},color:c}=this.config;if(n==="silent"||to(t,n))return;let m=[new Date().toISOString()];s&&m.push(c?or.ctx(s):s),m.push(c?`${or[t](t)}:`:`${t}:`,r),o!==void 0&&m.push(this.format(o)),Object.keys(a).length>0&&m.push(this.format(a)),console.log(m.join(" "))}debug(t,r){this.print("debug",t,r)}info(t,r){this.print("info",t,r)}warn(t,r){this.print("warn",t,r)}error(t,r){this.print("error",t,r)}child(t){return new e({...this.config,ctx:t})}get ctx(){return this.config.ctx}profile(t){let r=nr.performance.now();return()=>{let o=nr.performance.now()-r,{message:n,severity:s="debug",formatter:a=ro}=typeof t=="object"?t:{message:t};this.print(typeof s=="function"?s(o):s,n,a(o))}}};var Be=h(require("ramda"),1);var qe=class e extends Le{#e;constructor(t){super(),this.#e=t}get entries(){let t=[],r=Be.keys(this.#e);for(let o of r){let n=this.#e[o];n&&t.push([o,n,Be.reject(Be.equals(o),r)])}return Object.freeze(t)}deprecated(){let t=Object.entries(this.#e).reduce((r,[o,n])=>Object.assign(r,{[o]:n.deprecated()}),{});return new e(t)}};var so=h(require("express"),1),$e=class{#e;constructor(...t){this.#e=t}apply(t,r){return r(t,so.default.static(...this.#e))}};var rt=h(require("express"),1),Zo=h(require("node:http"),1),Io=h(require("node:https"),1);var _e=async(e,t="default")=>{try{return(await Promise.resolve().then(()=>h(require(e))))[t]}catch{}throw new Ce(e)};var mo=h(require("http-errors"),1);var io=h(require("ramda"),1);var At=class{constructor(t){this.logger=t}#e=io.tryCatch(_r);#t=new WeakSet;#r=new WeakMap;checkJsonCompat(t,r){if(!this.#t.has(t)){t.requestType==="json"&&this.#e(o=>this.logger.warn("The final input schema of the endpoint contains an unsupported JSON payload type.",Object.assign(r,{reason:o})))(t.inputSchema,"in");for(let o of De){let n=this.#e(s=>this.logger.warn(`The final ${o} response schema of the endpoint contains an unsupported JSON payload type.`,Object.assign(r,{reason:s})));for(let{mimeTypes:s,schema:a}of t.getResponses(o))s?.includes(I.json)&&n(a,"out")}this.#t.add(t)}}checkPathParams(t,r,o){let n=this.#r.get(r);if(n?.paths.includes(t))return;let s=lt(t);if(s.length===0)return;let{shape:a}=n||G(r.inputSchema);for(let c of s)c in a||this.logger.warn("The input schema of the endpoint is most likely missing the parameter of the path it's assigned to.",Object.assign(o,{path:t,param:c}));n?n.paths.push(t):this.#r.set(r,{shape:a,paths:[t]})}};var sr=["get","post","put","delete","patch"],ao=e=>sr.includes(e);var Mn=e=>{let[t,r]=e.trim().split(/ (.+)/,2);return r&&ao(t)?[r,t]:[e]},Ln=e=>e.trim().split("/").filter(Boolean).join("/"),po=(e,t)=>Object.entries(e).map(([r,o])=>{let[n,s]=Mn(r);return[[t||""].concat(Ln(n)||[]).join("/"),o,s]}),Un=(e,t)=>{throw new ae("Route with explicit method can only be assigned with Endpoint",e,t)},co=(e,t,r)=>{if(!(!r||r.includes(e)))throw new ae(`Method ${e} is not supported by the assigned Endpoint.`,e,t)},ir=(e,t,r)=>{let o=`${e} ${t}`;if(r.has(o))throw new ae("Route has a duplicate",e,t);r.add(o)},Ve=({routing:e,onEndpoint:t,onStatic:r})=>{let o=po(e),n=new Set;for(;o.length;){let[s,a,c]=o.shift();if(a instanceof tt)if(c)ir(c,s,n),co(c,s,a.methods),t(a,s,c);else{let{methods:m=["get"]}=a;for(let p of m)ir(p,s,n),t(a,s,p)}else if(c&&Un(c,s),a instanceof $e)r&&a.apply(s,r);else if(a instanceof qe)for(let[m,p,l]of a.entries){let{methods:b}=p;ir(m,s,n),co(m,s,b),t(p,s,m,l)}else o.unshift(...po(a,s))}};var Hn=e=>({method:t},r,o)=>{let n=e.join(", ").toUpperCase();r.set({Allow:n});let s=(0,mo.default)(405,`${t} is not allowed`,{headers:{Allow:n}});o(s)},ar=({app:e,getLogger:t,config:r,routing:o,parsers:n})=>{let s=Oe()?void 0:new At(t()),a=new Map;if(Ve({routing:o,onEndpoint:(m,p,l,b)=>{Oe()||(s?.checkJsonCompat(m,{path:p,method:l}),s?.checkPathParams(p,m,{method:l}));let g=n?.[m.requestType]||[],R=async(x,C)=>{let w=t(x);if(r.cors){let T={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":[l,...b||[],"options"].join(", ").toUpperCase(),"Access-Control-Allow-Headers":"content-type"},Z=typeof r.cors=="function"?await r.cors({request:x,endpoint:m,logger:w,defaultHeaders:T}):T;for(let j in Z)C.set(j,Z[j])}return m.execute({request:x,response:C,logger:w,config:r})};a.has(p)||(a.set(p,[]),r.cors&&(e.options(p,...g,R),a.get(p)?.push("options"))),a.get(p)?.push(l),e[l](p,...g,R)},onStatic:e.use.bind(e)}),s=void 0,r.wrongMethodBehavior!==404)for(let[m,p]of a.entries())e.all(m,Hn(p))};var xo=h(require("http-errors"),1);var ho=require("node:timers/promises");var lo=e=>"_httpMessage"in e&&typeof e._httpMessage=="object"&&e._httpMessage!==null&&"headersSent"in e._httpMessage&&typeof e._httpMessage.headersSent=="boolean"&&"setHeader"in e._httpMessage&&typeof e._httpMessage.setHeader=="function",uo=e=>"server"in e&&typeof e.server=="object"&&e.server!==null&&"close"in e.server&&typeof e.server.close=="function",fo=e=>"encrypted"in e&&typeof e.encrypted=="boolean"&&e.encrypted,yo=({},e)=>void(!e.headersSent&&e.setHeader("connection","close")),go=e=>new Promise((t,r)=>void e.close(o=>o?r(o):t()));var bo=(e,{timeout:t=1e3,logger:r}={})=>{let o,n=new Set,s=p=>void n.delete(p.destroy()),a=p=>void(lo(p)?!p._httpMessage.headersSent&&p._httpMessage.setHeader("connection","close"):s(p)),c=p=>void(o?p.destroy():n.add(p.once("close",()=>void n.delete(p))));for(let p of e)for(let l of["connection","secureConnection"])p.on(l,c);let m=async()=>{for(let p of e)p.on("request",yo);r?.info("Graceful shutdown",{sockets:n.size,timeout:t});for(let p of n)(fo(p)||uo(p))&&a(p);for await(let p of(0,ho.setInterval)(10,Date.now()))if(n.size===0||Date.now()-p>=t)break;for(let p of n)s(p);return Promise.allSettled(e.map(go))};return{sockets:n,shutdown:()=>o??=m()}};var So=({errorHandler:e,getLogger:t})=>async(r,o,n,s)=>r?e.execute({error:me(r),request:o,response:n,input:null,output:null,options:{},logger:t(o)}):s(),Ro=({errorHandler:e,getLogger:t})=>async(r,o)=>{let n=(0,xo.default)(404,`Can not ${r.method} ${r.path}`),s=t(r);try{await e.execute({request:r,response:o,logger:s,error:n,input:null,output:null,options:{}})}catch(a){Tt({response:o,logger:s,error:new ce(me(a),n)})}},Dn=e=>(t,{},r)=>{if(Object.values(t?.files||[]).flat().find(({truncated:n})=>n))return r(e);r()},Kn=e=>({log:e.debug.bind(e)}),To=async({getLogger:e,config:t})=>{let r=await _e("express-fileupload"),{limitError:o,beforeUpload:n,...s}={...typeof t.upload=="object"&&t.upload},a=[];return a.push(async(c,m,p)=>{let l=e(c);return await n?.({request:c,logger:l}),r({debug:!0,...s,abortOnLimit:!1,parseNested:!0,logger:Kn(l)})(c,m,p)}),o&&a.push(Dn(o)),a},Oo=(e,{},t)=>{Buffer.isBuffer(e.body)&&(e.body={raw:e.body}),t()},Po=({logger:e,config:{childLoggerProvider:t,accessLogger:r=({method:o,path:n},s)=>s.debug(`${o}: ${n}`)}})=>async(o,n,s)=>{let a=await t?.({request:o,parent:e})||e;r?.(o,a),o.res&&(o.res.locals[y]={logger:a}),s()},wo=e=>t=>t?.res?.locals[y]?.logger||e,Ao=e=>process.on("deprecation",({message:t,namespace:r,name:o,stack:n})=>e.warn(`${o} (${r}): ${t}`,n.split(`
`).slice(1))),Eo=({servers:e,logger:t,options:{timeout:r,events:o=["SIGINT","SIGTERM"]}})=>{let n=bo(e,{logger:t,timeout:r}),s=()=>n.shutdown().then(()=>process.exit());for(let a of o)process.on(a,s)};var B=require("ansis"),zo=e=>{if(e.columns<132)return;let t=(0,B.italic)("Proudly supports transgender community.".padStart(109)),r=(0,B.italic)("Start your API server with I/O schema validation and custom middlewares in minutes.".padStart(109)),o=(0,B.italic)("Thank you for choosing Express Zod API for your project.".padStart(132)),n=(0,B.italic)("for Sonia".padEnd(20)),s=(0,B.hex)("#F5A9B8"),a=(0,B.hex)("#5BCEFA"),c=new Array(14).fill(a,1,3).fill(s,3,5).fill(B.whiteBright,5,7).fill(s,7,9).fill(a,9,12).fill(B.gray,12,13),m=`
8888888888                                                          8888888888P              888             d8888 8888888b. 8888888
888                                                                       d88P               888            d88888 888   Y88b  888
888                                                                      d88P                888           d88P888 888    888  888
8888888    888  888 88888b.  888d888 .d88b.  .d8888b  .d8888b           d88P    .d88b.   .d88888          d88P 888 888   d88P  888
888        \u1FEFY8bd8P' 888 "88b 888P"  d8P  Y8b 88K      88K              d88P    d88""88b d88" 888         d88P  888 8888888P"   888
888          X88K   888  888 888    88888888 "Y8888b. "Y8888b.        d88P     888  888 888  888        d88P   888 888         888
888        .d8""8b. 888 d88P 888    Y8b.          X88      X88       d88P      Y88..88P Y88b 888       d8888888888 888         888
8888888888 888  888 88888P"  888     "Y8888   88888P'  88888P'      d8888888888 "Y88P"   "Y88888      d88P     888 888       8888888
                    888
                    888${t}
${n}888${r}
${o}
`;e.write(m.split(`
`).map((p,l)=>c[l]?c[l](p):p).join(`
`))};var vo=e=>{e.startupLogo!==!1&&zo(process.stdout);let t=e.errorHandler||ge,r=Xr(e.logger)?e.logger:new Fe(e.logger);r.debug("Running",{build:"v23.4.0 (CJS)",env:process.env.NODE_ENV||"development"}),Ao(r);let o=Po({logger:r,config:e}),s={getLogger:wo(r),errorHandler:t},a=Ro(s),c=So(s);return{...s,logger:r,notFoundHandler:a,catcher:c,loggingMiddleware:o}},ko=(e,t)=>{let{logger:r,getLogger:o,notFoundHandler:n,loggingMiddleware:s}=vo(e);return ar({app:e.app.use(s),routing:t,getLogger:o,config:e}),{notFoundHandler:n,logger:r}},Co=async(e,t)=>{let{logger:r,getLogger:o,notFoundHandler:n,catcher:s,loggingMiddleware:a}=vo(e),c=(0,rt.default)().disable("x-powered-by").use(a);if(e.compression){let g=await _e("compression");c.use(g(typeof e.compression=="object"?e.compression:void 0))}await e.beforeRouting?.({app:c,getLogger:o});let m={json:[e.jsonParser||rt.default.json()],raw:[e.rawParser||rt.default.raw(),Oo],form:[e.formParser||rt.default.urlencoded()],upload:e.upload?await To({config:e,getLogger:o}):[]};ar({app:c,routing:t,getLogger:o,config:e,parsers:m}),c.use(s,n);let p=[],l=(g,R)=>()=>g.listen(R,()=>r.info("Listening",R)),b=[];if(e.http){let g=Zo.default.createServer(c);p.push(g),b.push(l(g,e.http.listen))}if(e.https){let g=Io.default.createServer(e.https.options,c);p.push(g),b.push(l(g,e.https.listen))}return e.gracefulShutdown&&Eo({logger:r,servers:p,options:e.gracefulShutdown===!0?{}:e.gracefulShutdown}),{app:c,logger:r,servers:b.map(g=>g())}};var rn=require("openapi3-ts/oas31"),on=h(require("ramda"),1);var O=h(require("ramda"),1);var jo=e=>Te(e)&&"or"in e,No=e=>Te(e)&&"and"in e,pr=e=>!No(e)&&!jo(e),Mo=e=>{let t=O.filter(pr,e),r=O.chain(O.prop("and"),O.filter(No,e)),[o,n]=O.partition(pr,r),s=O.concat(t,o),a=O.filter(jo,e);return O.map(O.prop("or"),O.concat(a,n)).reduce((m,p)=>Re(m,O.map(l=>pr(l)?[l]:l.and,p),([l,b])=>O.concat(l,b)),O.reject(O.isEmpty,[s]))};var se=require("openapi3-ts/oas31"),d=h(require("ramda"),1),K=require("zod");var Ze=(e,{onEach:t,rules:r,onMissing:o,ctx:n={}})=>{let s=r[e._def[y]?.brand]||"typeName"in e._def&&r[e._def.typeName],c=s?s(e,{...n,next:p=>Ze(p,{ctx:n,onEach:t,rules:r,onMissing:o})}):o(e,n),m=t&&t(e,{prev:c,...n});return m?{...c,...m}:c};var Lo=["a-im","accept","accept-additions","accept-ch","accept-charset","accept-datetime","accept-encoding","accept-features","accept-language","accept-signature","access-control","access-control-request-headers","access-control-request-method","alpn","alt-used","alternates","amp-cache-transform","apply-to-redirect-ref","authentication-control","authentication-info","authorization","available-dictionary","c-ext","c-man","c-opt","c-pep","c-pep-info","cache-control","cal-managed-id","caldav-timezones","capsule-protocol","cert-not-after","cert-not-before","client-cert","client-cert-chain","close","cmcd-object","cmcd-request","cmcd-session","cmcd-status","cmsd-dynamic","cmsd-static","concealed-auth-export","configuration-context","connection","content-digest","content-disposition","content-encoding","content-id","content-language","content-length","content-location","content-md5","content-range","content-script-type","content-type","cookie","cookie2","cross-origin-embedder-policy","cross-origin-embedder-policy-report-only","cross-origin-opener-policy","cross-origin-opener-policy-report-only","cross-origin-resource-policy","cta-common-access-token","dasl","date","dav","default-style","delta-base","deprecation","depth","derived-from","destination","detached-jws","differential-id","dictionary-id","digest","dpop","dpop-nonce","early-data","ediint-features","expect","expect-ct","ext","forwarded","from","getprofile","hobareg","host","http2-settings","if","if-match","if-modified-since","if-none-match","if-range","if-schedule-tag-match","if-unmodified-since","im","include-referred-token-binding-id","isolation","keep-alive","label","last-event-id","link","link-template","lock-token","man","max-forwards","memento-datetime","meter","method-check","method-check-expires","mime-version","negotiate","nel","odata-entityid","odata-isolation","odata-maxversion","odata-version","opt","ordering-type","origin","origin-agent-cluster","oscore","oslc-core-version","overwrite","p3p","pep","pep-info","permissions-policy","pics-label","ping-from","ping-to","position","pragma","prefer","preference-applied","priority","profileobject","protocol","protocol-info","protocol-query","protocol-request","proxy-authorization","proxy-features","proxy-instruction","public","public-key-pins","public-key-pins-report-only","range","redirect-ref","referer","referer-root","referrer-policy","repeatability-client-id","repeatability-first-sent","repeatability-request-id","repeatability-result","replay-nonce","reporting-endpoints","repr-digest","safe","schedule-reply","schedule-tag","sec-fetch-storage-access","sec-gpc","sec-purpose","sec-token-binding","sec-websocket-extensions","sec-websocket-key","sec-websocket-protocol","sec-websocket-version","security-scheme","setprofile","signature","signature-input","slug","soapaction","status-uri","sunset","surrogate-capability","tcn","te","timeout","topic","traceparent","tracestate","trailer","transfer-encoding","ttl","upgrade","urgency","uri","use-as-dictionary","user-agent","variant-vary","via","want-content-digest","want-digest","want-repr-digest","warning","x-content-type-options","x-frame-options"];var Uo=50,Do="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString",Ko={integer:0,number:0,string:"",boolean:!1,object:{},null:null,array:[]},qn=/^\d{4}-\d{2}-\d{2}$/,Bn=/^\d{2}:\d{2}:\d{2}(\.\d+)?$/,$n=e=>e?/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(([+-]\d{2}:\d{2})|Z)$/:/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?Z$/,Fo=e=>e.replace(_t,t=>`{${t.slice(1)}}`),_n=({_def:e},{next:t})=>({...t(e.innerType),default:e[y]?.defaultLabel||e.defaultValue()}),Vn=({_def:{innerType:e}},{next:t})=>t(e),Gn=()=>({format:"any"}),Jn=({},e)=>{if(e.isResponse)throw new q("Please use ez.upload() only for input.",e);return{type:"string",format:"binary"}},Wn=e=>{let t=e.unwrap();return{type:"string",format:t instanceof K.z.ZodString?t._def.checks.find(r=>r.kind==="base64")?"byte":"file":"binary"}},Yn=({options:e},{next:t})=>({oneOf:e.map(t)}),Qn=({options:e,discriminator:t},{next:r})=>({discriminator:{propertyName:t},oneOf:e.map(r)}),Xn=(e,t)=>{if(Array.isArray(e)&&Array.isArray(t))return d.concat(e,t);if(e===t)return t;throw new Error("Can not flatten properties")},qo={type:d.always("object"),properties:({properties:e={}},{properties:t={}})=>d.mergeDeepWith(Xn,e,t),required:({required:e=[]},{required:t=[]})=>d.union(e,t),examples:({examples:e=[]},{examples:t=[]})=>Re(e,t,([r,o])=>d.mergeDeepRight(r,o))},es=d.both(({type:e})=>e==="object",d.pipe(Object.keys,d.without(Object.keys(qo)),d.isEmpty)),ts=d.tryCatch(e=>{let[t,r]=e.filter(se.isSchemaObject).filter(es);if(!t||!r)throw new Error("Can not flatten objects");let o=d.pickBy((n,s)=>(t[s]||r[s])!==void 0,qo);return d.map(n=>n(t,r),o)},(e,t)=>({allOf:t})),rs=({_def:{left:e,right:t}},{next:r})=>ts([e,t].map(r)),os=(e,{next:t})=>t(e.unwrap()),ns=(e,{next:t})=>t(e.unwrap()),ss=(e,{next:t})=>{let r=t(e.unwrap());return(0,se.isSchemaObject)(r)&&(r.type=$o(r)),r},is=e=>e in Ko,Bo=e=>{let t=d.toLower(d.type(e));return typeof e=="bigint"?"integer":is(t)?t:void 0},Ho=e=>({type:Bo(Object.values(e.enum)[0]),enum:Object.values(e.enum)}),as=({value:e})=>({type:Bo(e),const:e}),ps=(e,{isResponse:t,next:r})=>{let o=Object.keys(e.shape),n=c=>t?c instanceof K.z.ZodOptional:c.isOptional(),s=o.filter(c=>!n(e.shape[c])),a={type:"object"};return o.length&&(a.properties=Et(e,r)),s.length&&(a.required=s),a},cs=()=>({type:"null"}),ds=({},e)=>{if(e.isResponse)throw new q("Please use ez.dateOut() for output.",e);return{description:"YYYY-MM-DDTHH:mm:ss.sssZ",type:"string",format:"date-time",pattern:/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(\.\d+)?)?Z?$/.source,externalDocs:{url:Do}}},ms=({},e)=>{if(!e.isResponse)throw new q("Please use ez.dateIn() for input.",e);return{description:"YYYY-MM-DDTHH:mm:ss.sssZ",type:"string",format:"date-time",externalDocs:{url:Do}}},ls=({},e)=>{throw new q(`Using z.date() within ${e.isResponse?"output":"input"} schema is forbidden. Please use ez.date${e.isResponse?"Out":"In"}() instead. Check out the documentation for details.`,e)},us=()=>({type:"boolean"}),fs=()=>({type:"integer",format:"bigint"}),ys=e=>e.every(t=>t instanceof K.z.ZodLiteral),gs=({keySchema:e,valueSchema:t},{next:r})=>{if(e instanceof K.z.ZodEnum||e instanceof K.z.ZodNativeEnum){let o=Object.values(e.enum),n={type:"object"};return o.length&&(n.properties=Et(K.z.object(d.fromPairs(d.xprod(o,[t]))),r),n.required=o),n}if(e instanceof K.z.ZodLiteral)return{type:"object",properties:Et(K.z.object({[e.value]:t}),r),required:[e.value]};if(e instanceof K.z.ZodUnion&&ys(e.options)){let o=d.map(s=>`${s.value}`,e.options),n=d.fromPairs(d.xprod(o,[t]));return{type:"object",properties:Et(K.z.object(n),r),required:o}}return{type:"object",propertyNames:r(e),additionalProperties:r(t)}},hs=({_def:{minLength:e,maxLength:t,exactLength:r},element:o},{next:n})=>{let s={type:"array",items:n(o)};return r&&([s.minItems,s.maxItems]=Array(2).fill(r.value)),e&&(s.minItems=e.value),t&&(s.maxItems=t.value),s},bs=({items:e,_def:{rest:t}},{next:r})=>({type:"array",prefixItems:e.map(r),items:t===null?{not:{}}:r(t)}),xs=({isEmail:e,isURL:t,minLength:r,maxLength:o,isUUID:n,isCUID:s,isCUID2:a,isULID:c,isIP:m,isEmoji:p,isDatetime:l,isCIDR:b,isDate:g,isTime:R,isBase64:x,isNANOID:C,isBase64url:w,isDuration:Q,_def:{checks:L}})=>{let T=L.find(k=>k.kind==="regex"),Z=L.find(k=>k.kind==="datetime"),j=L.some(k=>k.kind==="jwt"),U=L.find(k=>k.kind==="length"),P={type:"string"},_={"date-time":l,byte:x,base64url:w,date:g,time:R,duration:Q,email:e,url:t,uuid:n,cuid:s,cuid2:a,ulid:c,nanoid:C,jwt:j,ip:m,cidr:b,emoji:p};for(let k in _)if(_[k]){P.format=k;break}return U&&([P.minLength,P.maxLength]=[U.value,U.value]),r!==null&&(P.minLength=r),o!==null&&(P.maxLength=o),g&&(P.pattern=qn.source),R&&(P.pattern=Bn.source),l&&(P.pattern=$n(Z?.offset).source),T&&(P.pattern=T.regex.source),P},Ss=({isInt:e,maxValue:t,minValue:r,_def:{checks:o}},{numericRange:n={integer:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],float:[-Number.MAX_VALUE,Number.MAX_VALUE]}})=>{let{integer:s,float:a}=n||{integer:null,float:null},c=o.find(x=>x.kind==="min"),m=r===null?e?s?.[0]:a?.[0]:r,p=c?c.inclusive:!0,l=o.find(x=>x.kind==="max"),b=t===null?e?s?.[1]:a?.[1]:t,g=l?l.inclusive:!0,R={type:e?"integer":"number",format:e?"int64":"double"};return p?R.minimum=m:R.exclusiveMinimum=m,g?R.maximum=b:R.exclusiveMaximum=b,R},Et=({shape:e},t)=>d.map(t,e),Rs=e=>{let t=Array.isArray(e.type)?e.type[0]:e.type;return Ko?.[t]},$o=({type:e})=>e==="null"?e:typeof e=="string"?[e,"null"]:e?[...new Set(e).add("null")]:"null",Ts=(e,{isResponse:t,next:r})=>{let o=r(e.innerType()),{effect:n}=e._def;if(t&&n.type==="transform"&&(0,se.isSchemaObject)(o)){let s=ft(e,Rs(o));return s&&["number","string","boolean"].includes(s)?{type:s}:r(K.z.any())}if(!t&&n.type==="preprocess"&&(0,se.isSchemaObject)(o)){let{type:s,...a}=o;return{...a,format:`${a.format||s} (preprocessed)`}}return o},Os=({_def:e},{isResponse:t,next:r})=>r(e[t?"out":"in"]),Ps=(e,{next:t})=>t(e.unwrap()),ws=(e,{next:t,makeRef:r})=>r(e,()=>t(e.schema)),As=(e,{next:t})=>t(e.unwrap().shape.raw),_o=e=>e.length?d.fromPairs(d.zip(d.times(t=>`example${t+1}`,e.length),d.map(d.objOf("value"),e))):void 0,Vo=(e,t,r=[])=>d.pipe(ne,d.map(d.when(o=>d.type(o)==="Object",d.omit(r))),_o)({schema:e,variant:t?"parsed":"original",validate:!0,pullProps:!0}),Es=(e,t)=>d.pipe(ne,d.filter(d.has(t)),d.pluck(t),_o)({schema:e,variant:"original",validate:!0,pullProps:!0}),zs=(e,t)=>t?.includes(e)||e.startsWith("x-")||Lo.includes(e),Go=({path:e,method:t,schema:r,inputSources:o,makeRef:n,composition:s,brandHandling:a,isHeader:c,security:m,numericRange:p,description:l=`${t.toUpperCase()} ${e} Parameter`})=>{let b=G(r),g=lt(e),R=o.includes("query"),x=o.includes("params"),C=o.includes("headers"),w=T=>x&&g.includes(T),Q=d.chain(d.filter(T=>T.type==="header"),m??[]).map(({name:T})=>T),L=T=>C&&(c?.(T,t,e)??zs(T,Q));return Object.entries(b.shape).reduce((T,[Z,j])=>{let U=w(Z)?"path":L(Z)?"header":R?"query":void 0;if(!U)return T;let P=Ze(j,{rules:{...a,...cr},onEach:dr,onMissing:mr,ctx:{isResponse:!1,makeRef:n,path:e,method:t,numericRange:p}}),_=s==="components"?n(j,P,le(l,Z)):P,{_def:k}=j;return T.concat({name:Z,in:U,deprecated:k[y]?.isDeprecated,required:!j.isOptional(),description:P.description||l,schema:_,examples:Es(b,Z)})},[])},cr={ZodString:xs,ZodNumber:Ss,ZodBigInt:fs,ZodBoolean:us,ZodNull:cs,ZodArray:hs,ZodTuple:bs,ZodRecord:gs,ZodObject:ps,ZodLiteral:as,ZodIntersection:rs,ZodUnion:Yn,ZodAny:Gn,ZodDefault:_n,ZodEnum:Ho,ZodNativeEnum:Ho,ZodEffects:Ts,ZodOptional:os,ZodNullable:ss,ZodDiscriminatedUnion:Qn,ZodBranded:Ps,ZodDate:ls,ZodCatch:Vn,ZodPipeline:Os,ZodLazy:ws,ZodReadonly:ns,[ee]:Wn,[Ne]:Jn,[Ae]:ms,[we]:ds,[ue]:As},dr=(e,{isResponse:t,prev:r})=>{if((0,se.isReferenceObject)(r))return{};let{description:o,_def:n}=e,s=e instanceof K.z.ZodLazy,a=r.type!==void 0,c=!t&&!s&&a&&e.isNullable(),m={};if(o&&(m.description=o),n[y]?.isDeprecated&&(m.deprecated=!0),c&&(m.type=$o(r)),!s){let p=ne({schema:e,variant:t?"parsed":"original",validate:!0});p.length&&(m.examples=p.slice())}return m},mr=(e,t)=>{throw new q(`Zod type ${e.constructor.name} is unsupported.`,t)},Jo=(e,t)=>{if((0,se.isReferenceObject)(e))return[e,!1];let r=!1,o=d.map(c=>{let[m,p]=Jo(c,t);return r=r||p,m}),n=d.omit(t),s={properties:n,examples:d.map(n),required:d.without(t),allOf:o,oneOf:o},a=d.evolve(s,e);return[a,r||!!a.required?.length]},Wo=e=>(0,se.isReferenceObject)(e)?e:d.omit(["examples"],e),Yo=({method:e,path:t,schema:r,mimeTypes:o,variant:n,makeRef:s,composition:a,hasMultipleStatusCodes:c,statusCode:m,brandHandling:p,numericRange:l,description:b=`${e.toUpperCase()} ${t} ${Jt(n)} response ${c?m:""}`.trim()})=>{if(!o)return{description:b};let g=Wo(Ze(r,{rules:{...p,...cr},onEach:dr,onMissing:mr,ctx:{isResponse:!0,makeRef:s,path:t,method:e,numericRange:l}})),R={schema:a==="components"?s(r,g,le(b)):g,examples:Vo(r,!0)};return{description:b,content:d.fromPairs(d.xprod(o,[R]))}},Zs=({format:e})=>{let t={type:"http",scheme:"bearer"};return e&&(t.bearerFormat=e),t},Is=({name:e},t)=>{let r={type:"apiKey",in:"query",name:e};return t?.includes("body")&&(t?.includes("query")?(r["x-in-alternative"]="body",r.description=`${e} CAN also be supplied within the request body`):(r["x-in-actual"]="body",r.description=`${e} MUST be supplied within the request body instead of query`)),r},vs=({name:e})=>({type:"apiKey",in:"header",name:e}),ks=({name:e})=>({type:"apiKey",in:"cookie",name:e}),Cs=({url:e})=>({type:"openIdConnect",openIdConnectUrl:e}),js=({flows:e={}})=>({type:"oauth2",flows:d.map(t=>({...t,scopes:t.scopes||{}}),d.reject(d.isNil,e))}),Qo=(e,t=[])=>{let r=o=>o.type==="basic"?{type:"http",scheme:"basic"}:o.type==="bearer"?Zs(o):o.type==="input"?Is(o,t):o.type==="header"?vs(o):o.type==="cookie"?ks(o):o.type==="openid"?Cs(o):js(o);return e.map(o=>o.map(r))},Xo=(e,t,r)=>e.map(o=>o.reduce((n,s)=>{let a=r(s),c=["oauth2","openIdConnect"].includes(s.type);return Object.assign(n,{[a]:c?t:[]})},{})),en=({method:e,path:t,schema:r,mimeType:o,makeRef:n,composition:s,brandHandling:a,paramNames:c,numericRange:m,description:p=`${e.toUpperCase()} ${t} Request body`})=>{let[l,b]=Jo(Ze(r,{rules:{...a,...cr},onEach:dr,onMissing:mr,ctx:{isResponse:!1,makeRef:n,path:t,method:e,numericRange:m}}),c),g=Wo(l),R={schema:s==="components"?n(r,g,le(p)):g,examples:Vo(G(r),!1,c)},x={description:p,content:{[o]:R}};return(b||o===I.raw)&&(x.required=!0),x},tn=e=>Object.entries(e).reduce((t,[r,o])=>{if(!o)return t;let n={name:r,description:typeof o=="string"?o:o.description};return typeof o=="object"&&o.url&&(n.externalDocs={url:o.url}),t.concat(n)},[]),lr=e=>e.length<=Uo?e:e.slice(0,Uo-1)+"\u2026",zt=e=>e.length?e.slice():void 0;var Zt=class extends rn.OpenApiBuilder{#e=new Map;#t=new Map;#r=new Map;#o(t,r,o=this.#r.get(t)){return o||(o=`Schema${this.#r.size+1}`,this.#r.set(t,o),typeof r=="function"&&(r=r())),typeof r=="object"&&this.addSchema(o,r),{$ref:`#/components/schemas/${o}`}}#n(t,r,o){let n=o||le(r,t),s=this.#t.get(n);if(s===void 0)return this.#t.set(n,1),n;if(o)throw new q(`Duplicated operationId: "${o}"`,{method:r,isResponse:!1,path:t});return s++,this.#t.set(n,s),`${n}${s}`}#s(t){let r=JSON.stringify(t);for(let n in this.rootDoc.components?.securitySchemes||{})if(r===JSON.stringify(this.rootDoc.components?.securitySchemes?.[n]))return n;let o=(this.#e.get(t.type)||0)+1;return this.#e.set(t.type,o),`${t.type.toUpperCase()}_${o}`}constructor({routing:t,config:r,title:o,version:n,serverUrl:s,descriptions:a,brandHandling:c,tags:m,isHeader:p,numericRange:l,hasSummaryFromDescription:b=!0,composition:g="inline"}){super(),this.addInfo({title:o,version:n});for(let x of typeof s=="string"?[s]:s)this.addServer({url:x});Ve({routing:t,onEndpoint:(x,C,w)=>{let Q={path:C,method:w,endpoint:x,composition:g,brandHandling:c,numericRange:l,makeRef:this.#o.bind(this)},{description:L,shortDescription:T,scopes:Z,inputSchema:j}=x,U=T?lr(T):b&&L?lr(L):void 0,P=r.inputSources?.[w]||Vt[w],_=this.#n(C,w,x.getOperationId(w)),k=Mo(x.security),xe=Go({...Q,inputSources:P,isHeader:p,security:k,schema:j,description:a?.requestParameter?.call(null,{method:w,path:C,operationId:_})}),it={};for(let ie of De){let Se=x.getResponses(ie);for(let{mimeTypes:qt,schema:pt,statusCodes:ct}of Se)for(let Bt of ct)it[Bt]=Yo({...Q,variant:ie,schema:pt,mimeTypes:qt,statusCode:Bt,hasMultipleStatusCodes:Se.length>1||ct.length>1,description:a?.[`${ie}Response`]?.call(null,{method:w,path:C,operationId:_,statusCode:Bt})})}let Kt=P.includes("body")?en({...Q,paramNames:on.pluck("name",xe),schema:j,mimeType:I[x.requestType],description:a?.requestBody?.call(null,{method:w,path:C,operationId:_})}):void 0,at=Xo(Qo(k,P),Z,ie=>{let Se=this.#s(ie);return this.addSecurityScheme(Se,ie),Se}),Ft={operationId:_,summary:U,description:L,deprecated:x.isDeprecated||void 0,tags:zt(x.tags),parameters:zt(xe),requestBody:Kt,security:zt(at),responses:it};this.addPath(Fo(C),{[w]:Ft})}}),m&&(this.rootDoc.tags=tn(m))}};var It=require("node-mocks-http");var Ns=e=>(0,It.createRequest)({...e,headers:{"content-type":I.json,...e?.headers}}),Ms=e=>(0,It.createResponse)(e),Ls=e=>{let t={warn:[],error:[],info:[],debug:[]};return new Proxy(e||{},{get(r,o,n){return o==="_getLogs"?()=>t:eo(o)?(...s)=>t[o].push(s):Reflect.get(r,o,n)}})},nn=({requestProps:e,responseOptions:t,configProps:r,loggerProps:o})=>{let n=Ns(e),s=Ms({req:n,...t});s.req=t?.req||n,n.res=s;let a=Ls(o),c={cors:!1,logger:a,...r};return{requestMock:n,responseMock:s,loggerMock:a,configMock:c}},sn=async({endpoint:e,...t})=>{let{requestMock:r,responseMock:o,loggerMock:n,configMock:s}=nn(t);return await e.execute({request:r,response:o,config:s,logger:n}),{requestMock:r,responseMock:o,loggerMock:n}},an=async({middleware:e,options:t={},...r})=>{let{requestMock:o,responseMock:n,loggerMock:s,configMock:{inputSources:a,errorHandler:c=ge}}=nn(r),m=ut(o,a),p={request:o,response:n,logger:s,input:m,options:t};try{let l=await e.execute(p);return{requestMock:o,responseMock:n,loggerMock:s,output:l}}catch(l){return await c.execute({...p,error:me(l),output:null}),{requestMock:o,responseMock:n,loggerMock:s,output:{}}}};var un=h(require("ramda"),1),st=h(require("typescript"),1),fn=require("zod");var mn=h(require("ramda"),1),Y=h(require("typescript"),1);var re=h(require("ramda"),1),u=h(require("typescript"),1),i=u.default.factory,vt=[i.createModifier(u.default.SyntaxKind.ExportKeyword)],Us=[i.createModifier(u.default.SyntaxKind.AsyncKeyword)],ot={public:[i.createModifier(u.default.SyntaxKind.PublicKeyword)],protectedReadonly:[i.createModifier(u.default.SyntaxKind.ProtectedKeyword),i.createModifier(u.default.SyntaxKind.ReadonlyKeyword)]},ur=(e,t)=>u.default.addSyntheticLeadingComment(e,u.default.SyntaxKind.MultiLineCommentTrivia,`* ${t} `,!0),fr=(e,t)=>{let r=u.default.createSourceFile("print.ts","",u.default.ScriptTarget.Latest,!1,u.default.ScriptKind.TS);return u.default.createPrinter(t).printNode(u.default.EmitHint.Unspecified,e,r)},Hs=/^[A-Za-z_$][A-Za-z0-9_$]*$/,yr=e=>typeof e=="string"&&Hs.test(e)?i.createIdentifier(e):z(e),kt=(e,...t)=>i.createTemplateExpression(i.createTemplateHead(e),t.map(([r,o=""],n)=>i.createTemplateSpan(r,n===t.length-1?i.createTemplateTail(o):i.createTemplateMiddle(o)))),Ct=(e,{type:t,mod:r,init:o,optional:n}={})=>i.createParameterDeclaration(r,void 0,e,n?i.createToken(u.default.SyntaxKind.QuestionToken):void 0,t?f(t):void 0,o),Ge=e=>Object.entries(e).map(([t,r])=>Ct(t,typeof r=="string"||typeof r=="number"||typeof r=="object"&&"kind"in r?{type:r}:r)),gr=(e,t=[])=>i.createConstructorDeclaration(ot.public,e,i.createBlock(t)),f=(e,t)=>typeof e=="number"?i.createKeywordTypeNode(e):typeof e=="string"||u.default.isIdentifier(e)?i.createTypeReferenceNode(e,t&&re.map(f,t)):e,hr=f("Record",[u.default.SyntaxKind.StringKeyword,u.default.SyntaxKind.AnyKeyword]),Ie=(e,t,{isOptional:r,isDeprecated:o,comment:n}={})=>{let s=i.createPropertySignature(void 0,yr(e),r?i.createToken(u.default.SyntaxKind.QuestionToken):void 0,f(t)),a=re.reject(re.isNil,[o?"@deprecated":void 0,n]);return a.length?ur(s,a.join(" ")):s},br=e=>u.default.setEmitFlags(e,u.default.EmitFlags.SingleLine),xr=(...e)=>i.createArrayBindingPattern(e.map(t=>i.createBindingElement(void 0,void 0,t))),M=(e,t,{type:r,expose:o}={})=>i.createVariableStatement(o&&vt,i.createVariableDeclarationList([i.createVariableDeclaration(e,void 0,r?f(r):void 0,t)],u.default.NodeFlags.Const)),Sr=(e,t)=>oe(e,i.createUnionTypeNode(re.map(F,t)),{expose:!0}),oe=(e,t,{expose:r,comment:o,params:n}={})=>{let s=i.createTypeAliasDeclaration(r?vt:void 0,e,n&&Pr(n),t);return o?ur(s,o):s},pn=(e,t)=>i.createPropertyDeclaration(ot.public,e,void 0,f(t),void 0),Rr=(e,t,r,{typeParams:o,returns:n}={})=>i.createMethodDeclaration(ot.public,void 0,e,void 0,o&&Pr(o),t,n,i.createBlock(r)),Tr=(e,t,{typeParams:r}={})=>i.createClassDeclaration(vt,e,r&&Pr(r),void 0,t),Or=e=>i.createTypeOperatorNode(u.default.SyntaxKind.KeyOfKeyword,f(e)),jt=e=>f(Promise.name,[e]),Nt=(e,t,{expose:r,comment:o}={})=>{let n=i.createInterfaceDeclaration(r?vt:void 0,e,void 0,void 0,t);return o?ur(n,o):n},Pr=e=>(Array.isArray(e)?e.map(t=>re.pair(t,void 0)):Object.entries(e)).map(([t,r])=>{let{type:o,init:n}=typeof r=="object"&&"init"in r?r:{type:r};return i.createTypeParameterDeclaration([],t,o?f(o):void 0,n?f(n):void 0)}),ve=(e,t,{isAsync:r}={})=>i.createArrowFunction(r?Us:void 0,void 0,Array.isArray(e)?re.map(Ct,e):Ge(e),void 0,void 0,t),A=e=>e,nt=(e,t,r)=>i.createConditionalExpression(e,i.createToken(u.default.SyntaxKind.QuestionToken),t,i.createToken(u.default.SyntaxKind.ColonToken),r),E=(e,...t)=>(...r)=>i.createCallExpression(t.reduce((o,n)=>typeof n=="string"||u.default.isIdentifier(n)?i.createPropertyAccessExpression(o,n):i.createElementAccessExpression(o,n),typeof e=="string"?i.createIdentifier(e):e),void 0,r),Je=(e,...t)=>i.createNewExpression(i.createIdentifier(e),void 0,t),Mt=(e,t)=>f("Extract",[e,t]),wr=(e,t)=>i.createExpressionStatement(i.createBinaryExpression(e,i.createToken(u.default.SyntaxKind.EqualsToken),t)),W=(e,t)=>i.createIndexedAccessTypeNode(f(e),f(t)),cn=e=>i.createUnionTypeNode([f(e),jt(e)]),Ar=(e,t)=>i.createFunctionTypeNode(void 0,Ge(e),f(t)),z=e=>typeof e=="number"?i.createNumericLiteral(e):typeof e=="boolean"?e?i.createTrue():i.createFalse():e===null?i.createNull():i.createStringLiteral(e),F=e=>i.createLiteralTypeNode(z(e)),Ds=[u.default.SyntaxKind.AnyKeyword,u.default.SyntaxKind.BigIntKeyword,u.default.SyntaxKind.BooleanKeyword,u.default.SyntaxKind.NeverKeyword,u.default.SyntaxKind.NumberKeyword,u.default.SyntaxKind.ObjectKeyword,u.default.SyntaxKind.StringKeyword,u.default.SyntaxKind.SymbolKeyword,u.default.SyntaxKind.UndefinedKeyword,u.default.SyntaxKind.UnknownKeyword,u.default.SyntaxKind.VoidKeyword],dn=e=>Ds.includes(e.kind);var Lt=class{constructor(t){this.serverUrl=t}paths=new Set;tags=new Map;registry=new Map;#e={pathType:i.createIdentifier("Path"),implementationType:i.createIdentifier("Implementation"),keyParameter:i.createIdentifier("key"),pathParameter:i.createIdentifier("path"),paramsArgument:i.createIdentifier("params"),ctxArgument:i.createIdentifier("ctx"),methodParameter:i.createIdentifier("method"),requestParameter:i.createIdentifier("request"),eventParameter:i.createIdentifier("event"),dataParameter:i.createIdentifier("data"),handlerParameter:i.createIdentifier("handler"),msgParameter:i.createIdentifier("msg"),parseRequestFn:i.createIdentifier("parseRequest"),substituteFn:i.createIdentifier("substitute"),provideMethod:i.createIdentifier("provide"),onMethod:i.createIdentifier("on"),implementationArgument:i.createIdentifier("implementation"),hasBodyConst:i.createIdentifier("hasBody"),undefinedValue:i.createIdentifier("undefined"),responseConst:i.createIdentifier("response"),restConst:i.createIdentifier("rest"),searchParamsConst:i.createIdentifier("searchParams"),defaultImplementationConst:i.createIdentifier("defaultImplementation"),clientConst:i.createIdentifier("client"),contentTypeConst:i.createIdentifier("contentType"),isJsonConst:i.createIdentifier("isJSON"),sourceProp:i.createIdentifier("source")};interfaces={input:i.createIdentifier("Input"),positive:i.createIdentifier("PositiveResponse"),negative:i.createIdentifier("NegativeResponse"),encoded:i.createIdentifier("EncodedResponse"),response:i.createIdentifier("Response")};methodType=Sr("Method",sr);someOfType=oe("SomeOf",W("T",Or("T")),{params:["T"]});requestType=oe("Request",Or(this.interfaces.input),{expose:!0});someOf=({name:t})=>f(this.someOfType.name,[t]);makePathType=()=>Sr(this.#e.pathType,Array.from(this.paths));makePublicInterfaces=()=>Object.keys(this.interfaces).map(t=>Nt(this.interfaces[t],Array.from(this.registry).map(([r,{store:o,isDeprecated:n}])=>Ie(r,o[t],{isDeprecated:n})),{expose:!0}));makeEndpointTags=()=>M("endpointTags",i.createObjectLiteralExpression(Array.from(this.tags).map(([t,r])=>i.createPropertyAssignment(yr(t),i.createArrayLiteralExpression(mn.map(z,r))))),{expose:!0});makeImplementationType=()=>oe(this.#e.implementationType,Ar({[this.#e.methodParameter.text]:this.methodType.name,[this.#e.pathParameter.text]:Y.default.SyntaxKind.StringKeyword,[this.#e.paramsArgument.text]:hr,[this.#e.ctxArgument.text]:{optional:!0,type:"T"}},jt(Y.default.SyntaxKind.AnyKeyword)),{expose:!0,params:{T:{init:Y.default.SyntaxKind.UnknownKeyword}}});makeParseRequestFn=()=>M(this.#e.parseRequestFn,ve({[this.#e.requestParameter.text]:Y.default.SyntaxKind.StringKeyword},i.createAsExpression(E(this.#e.requestParameter,A("split"))(i.createRegularExpressionLiteral("/ (.+)/"),z(2)),i.createTupleTypeNode([f(this.methodType.name),f(this.#e.pathType)]))));makeSubstituteFn=()=>M(this.#e.substituteFn,ve({[this.#e.pathParameter.text]:Y.default.SyntaxKind.StringKeyword,[this.#e.paramsArgument.text]:hr},i.createBlock([M(this.#e.restConst,i.createObjectLiteralExpression([i.createSpreadAssignment(this.#e.paramsArgument)])),i.createForInStatement(i.createVariableDeclarationList([i.createVariableDeclaration(this.#e.keyParameter)],Y.default.NodeFlags.Const),this.#e.paramsArgument,i.createBlock([wr(this.#e.pathParameter,E(this.#e.pathParameter,A("replace"))(kt(":",[this.#e.keyParameter]),ve([],i.createBlock([i.createExpressionStatement(i.createDeleteExpression(i.createElementAccessExpression(this.#e.restConst,this.#e.keyParameter))),i.createReturnStatement(i.createElementAccessExpression(this.#e.paramsArgument,this.#e.keyParameter))]))))])),i.createReturnStatement(i.createAsExpression(i.createArrayLiteralExpression([this.#e.pathParameter,this.#e.restConst]),f("const")))])));#t=()=>Rr(this.#e.provideMethod,Ge({[this.#e.requestParameter.text]:"K",[this.#e.paramsArgument.text]:W(this.interfaces.input,"K"),[this.#e.ctxArgument.text]:{optional:!0,type:"T"}}),[M(xr(this.#e.methodParameter,this.#e.pathParameter),E(this.#e.parseRequestFn)(this.#e.requestParameter)),i.createReturnStatement(E(i.createThis(),this.#e.implementationArgument)(this.#e.methodParameter,i.createSpreadElement(E(this.#e.substituteFn)(this.#e.pathParameter,this.#e.paramsArgument)),this.#e.ctxArgument))],{typeParams:{K:this.requestType.name},returns:jt(W(this.interfaces.response,"K"))});makeClientClass=t=>Tr(t,[gr([Ct(this.#e.implementationArgument,{type:f(this.#e.implementationType,["T"]),mod:ot.protectedReadonly,init:this.#e.defaultImplementationConst})]),this.#t()],{typeParams:["T"]});#r=t=>kt("?",[Je(URLSearchParams.name,t)]);#o=()=>Je(URL.name,kt("",[this.#e.pathParameter],[this.#e.searchParamsConst]),z(this.serverUrl));makeDefaultImplementation=()=>{let t=i.createPropertyAssignment(A("method"),E(this.#e.methodParameter,A("toUpperCase"))()),r=i.createPropertyAssignment(A("headers"),nt(this.#e.hasBodyConst,i.createObjectLiteralExpression([i.createPropertyAssignment(z("Content-Type"),z(I.json))]),this.#e.undefinedValue)),o=i.createPropertyAssignment(A("body"),nt(this.#e.hasBodyConst,E(JSON[Symbol.toStringTag],A("stringify"))(this.#e.paramsArgument),this.#e.undefinedValue)),n=M(this.#e.responseConst,i.createAwaitExpression(E(fetch.name)(this.#o(),i.createObjectLiteralExpression([t,r,o])))),s=M(this.#e.hasBodyConst,i.createLogicalNot(E(i.createArrayLiteralExpression([z("get"),z("delete")]),A("includes"))(this.#e.methodParameter))),a=M(this.#e.searchParamsConst,nt(this.#e.hasBodyConst,z(""),this.#r(this.#e.paramsArgument))),c=M(this.#e.contentTypeConst,E(this.#e.responseConst,A("headers"),A("get"))(z("content-type"))),m=i.createIfStatement(i.createPrefixUnaryExpression(Y.default.SyntaxKind.ExclamationToken,this.#e.contentTypeConst),i.createReturnStatement()),p=M(this.#e.isJsonConst,E(this.#e.contentTypeConst,A("startsWith"))(z(I.json))),l=i.createReturnStatement(E(this.#e.responseConst,nt(this.#e.isJsonConst,z(A("json")),z(A("text"))))());return M(this.#e.defaultImplementationConst,ve([this.#e.methodParameter,this.#e.pathParameter,this.#e.paramsArgument],i.createBlock([s,a,n,c,m,p,l]),{isAsync:!0}),{type:this.#e.implementationType})};#n=()=>gr(Ge({request:"K",params:W(this.interfaces.input,"K")}),[M(xr(this.#e.pathParameter,this.#e.restConst),E(this.#e.substituteFn)(i.createElementAccessExpression(E(this.#e.parseRequestFn)(this.#e.requestParameter),z(1)),this.#e.paramsArgument)),M(this.#e.searchParamsConst,this.#r(this.#e.restConst)),wr(i.createPropertyAccessExpression(i.createThis(),this.#e.sourceProp),Je("EventSource",this.#o()))]);#s=t=>i.createTypeLiteralNode([Ie(A("event"),t)]);#i=()=>Rr(this.#e.onMethod,Ge({[this.#e.eventParameter.text]:"E",[this.#e.handlerParameter.text]:Ar({[this.#e.dataParameter.text]:W(Mt("R",br(this.#s("E"))),F(A("data")))},cn(Y.default.SyntaxKind.VoidKeyword))}),[i.createExpressionStatement(E(i.createThis(),this.#e.sourceProp,A("addEventListener"))(this.#e.eventParameter,ve([this.#e.msgParameter],E(this.#e.handlerParameter)(E(JSON[Symbol.toStringTag],A("parse"))(i.createPropertyAccessExpression(i.createParenthesizedExpression(i.createAsExpression(this.#e.msgParameter,f(MessageEvent.name))),A("data"))))))),i.createReturnStatement(i.createThis())],{typeParams:{E:W("R",F(A("event")))}});makeSubscriptionClass=t=>Tr(t,[pn(this.#e.sourceProp,"EventSource"),this.#n(),this.#i()],{typeParams:{K:Mt(this.requestType.name,i.createTemplateLiteralType(i.createTemplateHead("get "),[i.createTemplateLiteralTypeSpan(f(Y.default.SyntaxKind.StringKeyword),i.createTemplateTail(""))])),R:Mt(W(this.interfaces.positive,"K"),br(this.#s(Y.default.SyntaxKind.StringKeyword)))}});makeUsageStatements=(t,r)=>[M(this.#e.clientConst,Je(t)),E(this.#e.clientConst,this.#e.provideMethod)(z("get /v1/user/retrieve"),i.createObjectLiteralExpression([i.createPropertyAssignment("id",z("10"))])),E(Je(r,z("get /v1/events/stream"),i.createObjectLiteralExpression()),this.#e.onMethod)(z("time"),ve(["time"],i.createBlock([])))]};var v=h(require("ramda"),1),S=h(require("typescript"),1),Ut=require("zod");var{factory:$}=S.default,Ks={[S.default.SyntaxKind.AnyKeyword]:"",[S.default.SyntaxKind.BigIntKeyword]:BigInt(0),[S.default.SyntaxKind.BooleanKeyword]:!1,[S.default.SyntaxKind.NumberKeyword]:0,[S.default.SyntaxKind.ObjectKeyword]:{},[S.default.SyntaxKind.StringKeyword]:"",[S.default.SyntaxKind.UndefinedKeyword]:void 0},Er={name:v.path(["name","text"]),type:v.path(["type"]),optional:v.path(["questionToken"])},Fs=({value:e})=>F(e),qs=({shape:e},{isResponse:t,next:r,optionalPropStyle:{withQuestionMark:o}})=>{let n=Object.entries(e).map(([s,a])=>{let{description:c,_def:m}=a,p=t?a instanceof Ut.z.ZodOptional:a.isOptional();return Ie(s,r(a),{comment:c,isOptional:p&&o,isDeprecated:m[y]?.isDeprecated})});return $.createTypeLiteralNode(n)},Bs=({element:e},{next:t})=>$.createArrayTypeNode(t(e)),$s=({options:e})=>$.createUnionTypeNode(e.map(F)),ln=({options:e},{next:t})=>{let r=new Map;for(let o of e){let n=t(o);r.set(dn(n)?n.kind:n,n)}return $.createUnionTypeNode(Array.from(r.values()))},_s=e=>Ks?.[e.kind],Vs=(e,{next:t,isResponse:r})=>{let o=t(e.innerType());if(r&&e._def.effect.type==="transform"){let n=ft(e,_s(o)),s={number:S.default.SyntaxKind.NumberKeyword,bigint:S.default.SyntaxKind.BigIntKeyword,boolean:S.default.SyntaxKind.BooleanKeyword,string:S.default.SyntaxKind.StringKeyword,undefined:S.default.SyntaxKind.UndefinedKeyword,object:S.default.SyntaxKind.ObjectKeyword};return f(n&&s[n]||S.default.SyntaxKind.AnyKeyword)}return o},Gs=e=>$.createUnionTypeNode(Object.values(e.enum).map(F)),Js=(e,{next:t,optionalPropStyle:{withUndefined:r}})=>{let o=t(e.unwrap());return r?$.createUnionTypeNode([o,f(S.default.SyntaxKind.UndefinedKeyword)]):o},Ws=(e,{next:t})=>$.createUnionTypeNode([t(e.unwrap()),F(null)]),Ys=({items:e,_def:{rest:t}},{next:r})=>$.createTupleTypeNode(e.map(r).concat(t===null?[]:$.createRestTypeNode(r(t)))),Qs=({keySchema:e,valueSchema:t},{next:r})=>f("Record",[e,t].map(r)),Xs=v.tryCatch(e=>{if(!e.every(S.default.isTypeLiteralNode))throw new Error("Not objects");let t=v.chain(v.prop("members"),e),r=v.uniqWith((...o)=>{if(!v.eqBy(Er.name,...o))return!1;if(v.both(v.eqBy(Er.type),v.eqBy(Er.optional))(...o))return!0;throw new Error("Has conflicting prop")},t);return $.createTypeLiteralNode(r)},(e,t)=>$.createIntersectionTypeNode(t)),ei=({_def:{left:e,right:t}},{next:r})=>Xs([e,t].map(r)),ti=({_def:e},{next:t})=>t(e.innerType),be=e=>()=>f(e),ri=(e,{next:t})=>t(e.unwrap()),oi=(e,{next:t})=>t(e.unwrap()),ni=({_def:e},{next:t})=>t(e.innerType),si=({_def:e},{next:t,isResponse:r})=>t(e[r?"out":"in"]),ii=()=>F(null),ai=(e,{makeAlias:t,next:r})=>t(e,()=>r(e.schema)),pi=e=>{let t=e.unwrap(),r=f(S.default.SyntaxKind.StringKeyword),o=f("Buffer"),n=$.createUnionTypeNode([r,o]);return t instanceof Ut.z.ZodString?r:t instanceof Ut.z.ZodUnion?n:o},ci=(e,{next:t})=>t(e.unwrap().shape.raw),di={ZodString:be(S.default.SyntaxKind.StringKeyword),ZodNumber:be(S.default.SyntaxKind.NumberKeyword),ZodBigInt:be(S.default.SyntaxKind.BigIntKeyword),ZodBoolean:be(S.default.SyntaxKind.BooleanKeyword),ZodAny:be(S.default.SyntaxKind.AnyKeyword),ZodUndefined:be(S.default.SyntaxKind.UndefinedKeyword),[we]:be(S.default.SyntaxKind.StringKeyword),[Ae]:be(S.default.SyntaxKind.StringKeyword),ZodNull:ii,ZodArray:Bs,ZodTuple:Ys,ZodRecord:Qs,ZodObject:qs,ZodLiteral:Fs,ZodIntersection:ei,ZodUnion:ln,ZodDefault:ti,ZodEnum:$s,ZodNativeEnum:Gs,ZodEffects:Vs,ZodOptional:Js,ZodNullable:Ws,ZodDiscriminatedUnion:ln,ZodBranded:ri,ZodCatch:ni,ZodPipeline:si,ZodLazy:ai,ZodReadonly:oi,[ee]:pi,[ue]:ci},zr=(e,{brandHandling:t,ctx:r})=>Ze(e,{rules:{...t,...di},onMissing:()=>f(S.default.SyntaxKind.AnyKeyword),ctx:r});var Ht=class extends Lt{#e=[this.someOfType];#t=new Map;#r=[];#o(t,r){let o=this.#t.get(t)?.name?.text;if(!o){o=`Type${this.#t.size+1}`;let n=F(null);this.#t.set(t,oe(o,n)),this.#t.set(t,oe(o,r()))}return f(o)}constructor({routing:t,brandHandling:r,variant:o="client",clientClassName:n="Client",subscriptionClassName:s="Subscription",serverUrl:a="https://example.com",optionalPropStyle:c={withQuestionMark:!0,withUndefined:!0},noContent:m=fn.z.undefined()}){super(a);let p={makeAlias:this.#o.bind(this),optionalPropStyle:c},l={brandHandling:r,ctx:{...p,isResponse:!1}},b={brandHandling:r,ctx:{...p,isResponse:!0}};Ve({routing:t,onEndpoint:(R,x,C)=>{let w=le.bind(null,C,x),{isDeprecated:Q,inputSchema:L,tags:T}=R,Z=`${C} ${x}`,j=oe(w("input"),zr(L,l),{comment:Z});this.#e.push(j);let U=De.reduce((k,xe)=>{let it=R.getResponses(xe),Kt=un.chain(([Ft,{schema:ie,mimeTypes:Se,statusCodes:qt}])=>{let pt=oe(w(xe,"variant",`${Ft+1}`),zr(Se?ie:m,b),{comment:Z});return this.#e.push(pt),qt.map(ct=>Ie(ct,pt.name))},Array.from(it.entries())),at=Nt(w(xe,"response","variants"),Kt,{comment:Z});return this.#e.push(at),Object.assign(k,{[xe]:at})},{});this.paths.add(x);let P=F(Z),_={input:f(j.name),positive:this.someOf(U.positive),negative:this.someOf(U.negative),response:i.createUnionTypeNode([W(this.interfaces.positive,P),W(this.interfaces.negative,P)]),encoded:i.createIntersectionTypeNode([f(U.positive.name),f(U.negative.name)])};this.registry.set(Z,{isDeprecated:Q,store:_}),this.tags.set(Z,T)}}),this.#e.unshift(...this.#t.values()),this.#e.push(this.makePathType(),this.methodType,...this.makePublicInterfaces(),this.requestType),o!=="types"&&(this.#e.push(this.makeEndpointTags(),this.makeParseRequestFn(),this.makeSubstituteFn(),this.makeImplementationType(),this.makeDefaultImplementation(),this.makeClientClass(n),this.makeSubscriptionClass(s)),this.#r.push(...this.makeUsageStatements(n,s)))}#n(t){return this.#r.length?this.#r.map(r=>typeof r=="string"?r:fr(r,t)).join(`
`):void 0}print(t){let r=this.#n(t),o=r&&st.default.addSyntheticLeadingComment(st.default.addSyntheticLeadingComment(i.createEmptyStatement(),st.default.SyntaxKind.SingleLineCommentTrivia," Usage example:"),st.default.SyntaxKind.MultiLineCommentTrivia,`
${r}`);return this.#e.concat(o||[]).map((n,s)=>fr(n,s<this.#e.length?t:{...t,omitTrailingSemicolon:!0})).join(`

`)}async printFormatted({printerOptions:t,format:r}={}){let o=r;if(!o)try{let a=(await _e("prettier")).format;o=c=>a(c,{filepath:"client.ts"})}catch{}let n=this.#n(t);this.#r=n&&o?[await o(n)]:this.#r;let s=this.print(t);return o?o(s):s}};var ke=require("zod");var gn=(e,t)=>ke.z.object({data:t,event:ke.z.literal(e),id:ke.z.string().optional(),retry:ke.z.number().int().positive().optional()}),mi=(e,t,r)=>gn(String(t),e[t]).transform(o=>[`event: ${o.event}`,`data: ${JSON.stringify(o.data)}`,"",""].join(`
`)).parse({event:t,data:r}),li=1e4,yn=e=>e.headersSent||e.writeHead(200,{connection:"keep-alive","content-type":I.sse,"cache-control":"no-cache"}),ui=e=>new V({handler:async({response:t})=>setTimeout(()=>yn(t),li)&&{isClosed:()=>t.writableEnded||t.closed,emit:(r,o)=>{yn(t),t.write(mi(e,r,o),"utf-8"),t.flush?.()}}}),fi=e=>new ye({positive:()=>{let[t,...r]=Object.entries(e).map(([o,n])=>gn(o,n));return{mimeType:I.sse,schema:r.length?ke.z.discriminatedUnion("event",[t,...r]):t}},negative:{mimeType:"text/plain",schema:ke.z.string()},handler:async({response:t,error:r,logger:o,request:n,input:s})=>{if(r){let a=Ee(r);et(a,o,n,s),t.headersSent||t.status(a.statusCode).type("text/plain").write(ze(a),"utf-8")}t.end()}}),Dt=class extends he{constructor(t){super(fi(t)),this.middlewares=[ui(t)]}};var hn={dateIn:kr,dateOut:jr,form:Mr,file:ht,upload:Kr,raw:Hr};0&&(module.exports={BuiltinLogger,DependsOnMethod,Documentation,DocumentationError,EndpointsFactory,EventStreamFactory,InputValidationError,Integration,Middleware,MissingPeerError,OutputValidationError,ResultHandler,RoutingError,ServeStatic,arrayEndpointsFactory,arrayResultHandler,attachRouting,createConfig,createServer,defaultEndpointsFactory,defaultResultHandler,ensureHttpError,ez,getExamples,getMessageFromError,testEndpoint,testMiddleware});
