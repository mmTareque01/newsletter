import*as H from"ramda";import{z as Ae}from"zod";import*as U from"ramda";import{z as br}from"zod";var Z={json:"application/json",upload:"multipart/form-data",raw:"application/octet-stream",sse:"text/event-stream",form:"application/x-www-form-urlencoded"};var de=class extends Error{name="RoutingError";cause;constructor(t,r,o){super(t),this.cause={method:r,path:o}}},B=class extends Error{name="DocumentationError";cause;constructor(t,{method:r,path:o,isResponse:n}){super(t),this.cause=`${n?"Response":"Input"} schema of an Endpoint assigned to ${r.toUpperCase()} method of ${o} path.`}},rt=class extends Error{name="IOSchemaError"},me=class extends rt{constructor(r){super(le(r),{cause:r});this.cause=r}name="OutputValidationError"},ee=class extends rt{constructor(r){super(le(r),{cause:r});this.cause=r}name="InputValidationError"},re=class extends Error{constructor(r,o){super(le(r),{cause:r});this.cause=r;this.handled=o}name="ResultHandlerError"},Ke=class extends Error{name="MissingPeerError";constructor(t){super(`Missing peer dependency: ${t}. Please install it to use the feature.`)}};var jt=/:([A-Za-z0-9_]+)/g,ot=e=>e.match(jt)?.map(t=>t.slice(1))||[],$o=e=>{let r=(e.header("content-type")||"").toLowerCase().startsWith(Z.upload);return"files"in e&&r},Nt={get:["query","params"],post:["body","params","files"],put:["body","params"],patch:["body","params"],delete:["query","params"]},_o=["body","query","params"],Mt=e=>e.method.toLowerCase(),nt=(e,t={})=>{let r=Mt(e);return r==="options"?{}:(t[r]||Nt[r]||_o).filter(o=>o==="files"?$o(e):!0).reduce((o,n)=>Object.assign(o,e[n]),{})},oe=e=>e instanceof Error?e:new Error(String(e)),le=e=>e instanceof br.ZodError?e.issues.map(({path:t,message:r})=>(t.length?[t.join("/")]:[]).concat(r).join(": ")).join("; "):e instanceof me?`output${e.cause.issues[0]?.path.length>0?"/":": "}${e.message}`:e.message,Vo=e=>Object.entries(e.shape).reduce((t,[r,o])=>{let{_def:n}=o;return ue(t,(n[y]?.examples||[]).map(U.objOf(r)),([s,a])=>({...s,...a}))},[]),ne=({schema:e,variant:t="original",validate:r=t==="parsed",pullProps:o=!1})=>{let n=e._def[y]?.examples||[];if(!n.length&&o&&e instanceof br.ZodObject&&(n=Vo(e)),!r&&t==="original")return n;let s=[];for(let a of n){let c=e.safeParse(a);c.success&&s.push(t==="parsed"?c.data:a)}return s},ue=(e,t,r)=>e.length&&t.length?U.xprod(e,t).map(r):e.concat(t),Lt=e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase(),se=(...e)=>{let t=U.chain(o=>o.split(/[^A-Z0-9]/gi),e);return U.chain(o=>o.replaceAll(/[A-Z]+/g,n=>`/${n}`).split("/"),t).map(Lt).join("")},st=U.tryCatch((e,t)=>typeof e.parse(t),U.always(void 0)),fe=e=>typeof e=="object"&&e!==null,ye=U.memoizeWith(()=>"static",()=>process.env.NODE_ENV==="production");import*as it from"ramda";var y=Symbol.for("express-zod-api"),Fe=e=>{let t=e.describe(e.description);return t._def[y]=it.clone(t._def[y])||{examples:[]},t},xr=(e,t)=>{if(!(y in e._def))return t;let r=Fe(t);return r._def[y].examples=ue(r._def[y].examples,e._def[y].examples,([o,n])=>typeof o=="object"&&typeof n=="object"?it.mergeDeepRight({...o},{...n}):n),r};var Go=function(e){let t=Fe(this);return t._def[y].examples.push(e),t},Jo=function(){let e=Fe(this);return e._def[y].isDeprecated=!0,e},Wo=function(e){let t=Fe(this);return t._def[y].defaultLabel=e,t},Yo=function(e){return new Ae.ZodBranded({typeName:Ae.ZodFirstPartyTypeKind.ZodBranded,type:this,description:this._def.description,errorMap:this._def.errorMap,[y]:{examples:[],...H.clone(this._def[y]),brand:e}})},Qo=function(e){let t=typeof e=="function"?e:H.pipe(H.toPairs,H.map(([n,s])=>H.pair(e[String(n)]||n,s)),H.fromPairs),r=t(H.clone(this.shape)),o=Ae.object(r)[this._def.unknownKeys]();return this.transform(t).pipe(o)};y in globalThis||(globalThis[y]=!0,Object.defineProperties(Ae.ZodType.prototype,{example:{get(){return Go.bind(this)}},deprecated:{get(){return Jo.bind(this)}},brand:{set(){},get(){return Yo.bind(this)}}}),Object.defineProperty(Ae.ZodDefault.prototype,"label",{get(){return Wo.bind(this)}}),Object.defineProperty(Ae.ZodObject.prototype,"remap",{get(){return Qo.bind(this)}}));function Xo(e){return e}import{z as Ur}from"zod";import*as ve from"ramda";import{z as Nr}from"zod";import{fail as N}from"node:assert/strict";import{z as qe}from"zod";var at=e=>!isNaN(e.getTime());var ge=Symbol("DateIn"),Sr=()=>qe.union([qe.string().date(),qe.string().datetime(),qe.string().datetime({local:!0})]).transform(t=>new Date(t)).pipe(qe.date().refine(at)).brand(ge);import{z as en}from"zod";var he=Symbol("DateOut"),Rr=()=>en.date().refine(at).transform(e=>e.toISOString()).brand(he);import{z as pt}from"zod";var G=Symbol("File"),Tr=pt.custom(e=>Buffer.isBuffer(e),{message:"Expected Buffer"}),tn={buffer:()=>Tr.brand(G),string:()=>pt.string().brand(G),binary:()=>Tr.or(pt.string()).brand(G),base64:()=>pt.string().base64().brand(G)};function ct(e){return tn[e||"string"]()}import{z as Or}from"zod";var dt=Symbol("Form"),Pr=e=>(e instanceof Or.ZodObject?e:Or.object(e)).brand(dt);import{z as rn}from"zod";var ie=Symbol("Raw"),wr=rn.object({raw:ct("buffer")});function Ar(e){return(e?wr.extend(e):wr).brand(ie)}import{z as on}from"zod";var Ee=Symbol("Upload"),Er=()=>on.custom(e=>typeof e=="object"&&e!==null&&"name"in e&&"encoding"in e&&"mimetype"in e&&"data"in e&&"tempFilePath"in e&&"truncated"in e&&"size"in e&&"md5"in e&&"mv"in e&&typeof e.name=="string"&&typeof e.encoding=="string"&&typeof e.mimetype=="string"&&Buffer.isBuffer(e.data)&&typeof e.tempFilePath=="string"&&typeof e.truncated=="boolean"&&typeof e.size=="number"&&typeof e.md5=="string"&&typeof e.mv=="function",e=>({message:`Expected file upload, received ${typeof e}`})).brand(Ee);var zr=(e,{next:t})=>e.options.some(t),nn=({_def:e},{next:t})=>[e.left,e.right].some(t),mt=(e,{next:t})=>t(e.unwrap()),lt={ZodObject:({shape:e},{next:t})=>Object.values(e).some(t),ZodUnion:zr,ZodDiscriminatedUnion:zr,ZodIntersection:nn,ZodEffects:(e,{next:t})=>t(e.innerType()),ZodOptional:mt,ZodNullable:mt,ZodRecord:({valueSchema:e},{next:t})=>t(e),ZodArray:({element:e},{next:t})=>t(e),ZodDefault:({_def:e},{next:t})=>t(e.innerType)},Be=(e,{condition:t,rules:r=lt,depth:o=1,maxDepth:n=Number.POSITIVE_INFINITY})=>{if(t?.(e))return!0;let s=o<n?r[e._def[y]?.brand]||"typeName"in e._def&&r[e._def.typeName]:void 0;return s?s(e,{next:a=>Be(a,{condition:t,rules:r,maxDepth:n,depth:o+1})}):!1},Zr=e=>Be(e,{condition:t=>t._def[y]?.brand===Ee,rules:{...lt,[dt]:(t,{next:r})=>Object.values(t.unwrap().shape).some(r)}}),Ir=e=>Be(e,{condition:t=>t._def[y]?.brand===ie,maxDepth:3}),vr=e=>Be(e,{condition:t=>t._def[y]?.brand===dt,maxDepth:3}),kr=(e,t)=>{let r=new WeakSet;return Be(e,{maxDepth:300,rules:{...lt,ZodBranded:mt,ZodReadonly:mt,ZodCatch:({_def:{innerType:o}},{next:n})=>n(o),ZodPipeline:({_def:o},{next:n})=>n(o[t]),ZodLazy:(o,{next:n})=>r.has(o)?!1:r.add(o)&&n(o.schema),ZodTuple:({items:o,_def:{rest:n}},{next:s})=>[...o].concat(n??[]).some(s),ZodEffects:{out:void 0,in:lt.ZodEffects}[t],ZodNaN:()=>N("z.nan()"),ZodSymbol:()=>N("z.symbol()"),ZodFunction:()=>N("z.function()"),ZodMap:()=>N("z.map()"),ZodSet:()=>N("z.set()"),ZodBigInt:()=>N("z.bigint()"),ZodVoid:()=>N("z.void()"),ZodPromise:()=>N("z.promise()"),ZodNever:()=>N("z.never()"),ZodDate:()=>t==="in"&&N("z.date()"),[he]:()=>t==="in"&&N("ez.dateOut()"),[ge]:()=>t==="out"&&N("ez.dateIn()"),[ie]:()=>t==="out"&&N("ez.raw()"),[Ee]:()=>t==="out"&&N("ez.upload()"),[G]:()=>!1}})};import pn,{isHttpError as cn}from"http-errors";import Cr,{isHttpError as sn}from"http-errors";import{z as an}from"zod";var Ut=(e,{variant:t,args:r,...o})=>{if(typeof e=="function"&&(e=e(...r)),e instanceof an.ZodType)return[{schema:e,...o}];if(Array.isArray(e)&&!e.length){let n=new Error(`At least one ${t} response schema required.`);throw new re(n)}return(Array.isArray(e)?e:[e]).map(({schema:n,statusCode:s,mimeType:a})=>({schema:n,statusCodes:typeof s=="number"?[s]:s||o.statusCodes,mimeTypes:typeof a=="string"?[a]:a===void 0?o.mimeTypes:a}))},$e=(e,t,{url:r},o)=>!e.expose&&t.error("Server side error",{error:e,url:r,payload:o}),ze=e=>sn(e)?e:Cr(e instanceof ee?400:500,le(e),{cause:e.cause||e}),be=e=>ye()&&!e.expose?Cr(e.statusCode).message:e.message;var ut=({error:e,logger:t,response:r})=>{t.error("Result handler failure",e);let o=be(pn(500,`An error occurred while serving the result: ${e.message}.`+(e.handled?`
Original error: ${e.handled.message}.`:""),{expose:cn(e.cause)?e.cause.expose:!1}));r.status(500).type("text/plain").end(o)};import{z as jr}from"zod";var Ht=class{},J=class extends Ht{#e;#t;#r;constructor({input:t=jr.object({}),security:r,handler:o}){super(),this.#e=t,this.#t=r,this.#r=o}get security(){return this.#t}get schema(){return this.#e}async execute({input:t,...r}){try{let o=await this.#e.parseAsync(t);return this.#r({...r,input:o})}catch(o){throw o instanceof jr.ZodError?new ee(o):o}}},Ze=class extends J{constructor(t,{provider:r=()=>({}),transformer:o=n=>n}={}){super({handler:async({request:n,response:s})=>new Promise((a,c)=>{let m=p=>{if(p&&p instanceof Error)return c(o(p));a(r(n,s))};t(n,s,m)?.catch(m)})})}};var Ie=class{nest(t){return Object.assign(t,{"":this})}};var _e=class extends Ie{},ft=class e extends _e{#e;constructor(t){super(),this.#e=t}#t(t){return new e({...this.#e,...t})}deprecated(){return this.#t({deprecated:!0})}get isDeprecated(){return this.#e.deprecated||!1}get description(){return this.#e.description}get shortDescription(){return this.#e.shortDescription}get methods(){return Object.freeze(this.#e.methods)}get inputSchema(){return this.#e.inputSchema}get outputSchema(){return this.#e.outputSchema}get requestType(){return Zr(this.#e.inputSchema)?"upload":Ir(this.#e.inputSchema)?"raw":vr(this.#e.inputSchema)?"form":"json"}getResponses(t){return Object.freeze(t==="negative"?this.#e.resultHandler.getNegativeResponse():this.#e.resultHandler.getPositiveResponse(this.#e.outputSchema))}get security(){let t=ve.pluck("security",this.#e.middlewares||[]);return ve.reject(ve.isNil,t)}get scopes(){return Object.freeze(this.#e.scopes||[])}get tags(){return Object.freeze(this.#e.tags||[])}getOperationId(t){return this.#e.getOperationId?.(t)}async#r(t){try{return await this.#e.outputSchema.parseAsync(t)}catch(r){throw r instanceof Nr.ZodError?new me(r):r}}async#o({method:t,logger:r,options:o,response:n,...s}){for(let a of this.#e.middlewares||[])if(!(t==="options"&&!(a instanceof Ze))&&(Object.assign(o,await a.execute({...s,options:o,response:n,logger:r})),n.writableEnded)){r.warn("A middleware has closed the stream. Accumulated options:",o);break}}async#n({input:t,...r}){let o;try{o=await this.#e.inputSchema.parseAsync(t)}catch(n){throw n instanceof Nr.ZodError?new ee(n):n}return this.#e.handler({...r,input:o})}async#s({error:t,...r}){try{await this.#e.resultHandler.execute({...r,error:t})}catch(o){ut({...r,error:new re(oe(o),t||void 0)})}}async execute({request:t,response:r,logger:o,config:n}){let s=Mt(t),a={},c=null,m=null,p=nt(t,n.inputSources);try{if(await this.#o({method:s,input:p,request:t,response:r,logger:o,options:a}),r.writableEnded)return;if(s==="options")return void r.status(200).end();c=await this.#r(await this.#n({input:p,logger:o,options:a}))}catch(l){m=oe(l)}await this.#s({input:p,output:c,request:t,response:r,error:m,logger:o,options:a})}};import*as Mr from"ramda";import{z as xe}from"zod";var Lr=(e,t)=>{let r=Mr.pluck("schema",e);r.push(t);let o=r.reduce((n,s)=>n.and(s));return r.reduce((n,s)=>xr(s,n),o)},$=e=>e instanceof xe.ZodObject?e:e instanceof xe.ZodBranded?$(e.unwrap()):e instanceof xe.ZodUnion||e instanceof xe.ZodDiscriminatedUnion?e.options.map(t=>$(t)).reduce((t,r)=>t.merge(r.partial()),xe.object({})):e instanceof xe.ZodEffects?$(e._def.schema):e instanceof xe.ZodPipeline?$(e._def.in):$(e._def.left).merge($(e._def.right));import{z as W}from"zod";var ke={positive:200,negative:400},Ce=Object.keys(ke);var Dt=class{#e;constructor(t){this.#e=t}execute(...t){return this.#e(...t)}},Se=class extends Dt{#e;#t;constructor(t){super(t.handler),this.#e=t.positive,this.#t=t.negative}getPositiveResponse(t){return Ut(this.#e,{variant:"positive",args:[t],statusCodes:[ke.positive],mimeTypes:[Z.json]})}getNegativeResponse(){return Ut(this.#t,{variant:"negative",args:[],statusCodes:[ke.negative],mimeTypes:[Z.json]})}},Re=new Se({positive:e=>{let t=ne({schema:e,pullProps:!0}),r=W.object({status:W.literal("success"),data:e});return t.reduce((o,n)=>o.example({status:"success",data:n}),r)},negative:W.object({status:W.literal("error"),error:W.object({message:W.string()})}).example({status:"error",error:{message:"Sample error message"}}),handler:({error:e,input:t,output:r,request:o,response:n,logger:s})=>{if(e){let a=ze(e);return $e(a,s,o,t),void n.status(a.statusCode).set(a.headers).json({status:"error",error:{message:be(a)}})}n.status(ke.positive).json({status:"success",data:r})}}),Kt=new Se({positive:e=>{let t=ne({schema:e}),r="shape"in e&&"items"in e.shape&&e.shape.items instanceof W.ZodArray?e.shape.items:W.array(W.any());return t.reduce((o,n)=>fe(n)&&"items"in n&&Array.isArray(n.items)?o.example(n.items):o,r)},negative:W.string().example("Sample error message"),handler:({response:e,output:t,error:r,logger:o,request:n,input:s})=>{if(r){let a=ze(r);return $e(a,o,n,s),void e.status(a.statusCode).type("text/plain").send(be(a))}if(t&&"items"in t&&Array.isArray(t.items))return void e.status(ke.positive).json(t.items);throw new Error("Property 'items' is missing in the endpoint output")}});var Te=class e{constructor(t){this.resultHandler=t}middlewares=[];static#e(t,r){let o=new e(r);return o.middlewares=t,o}addMiddleware(t){return e.#e(this.middlewares.concat(t instanceof J?t:new J(t)),this.resultHandler)}use=this.addExpressMiddleware;addExpressMiddleware(...t){return e.#e(this.middlewares.concat(new Ze(...t)),this.resultHandler)}addOptions(t){return e.#e(this.middlewares.concat(new J({handler:t})),this.resultHandler)}build({input:t=Ur.object({}),output:r,operationId:o,scope:n,tag:s,method:a,...c}){let{middlewares:m,resultHandler:p}=this,l=typeof a=="string"?[a]:a,h=typeof o=="function"?o:()=>o,g=typeof n=="string"?[n]:n||[],S=typeof s=="string"?[s]:s||[];return new ft({...c,middlewares:m,outputSchema:r,resultHandler:p,scopes:g,tags:S,methods:l,getOperationId:h,inputSchema:Lr(m,t)})}buildVoid({handler:t,...r}){return this.build({...r,output:Ur.object({}),handler:async o=>(await t(o),{})})}},dn=new Te(Re),mn=new Te(Kt);import bn from"ansis";import{inspect as xn}from"node:util";import{performance as Br}from"node:perf_hooks";import{blue as ln,green as un,hex as fn,red as yn,cyanBright as gn}from"ansis";import*as Hr from"ramda";var Ft={debug:ln,info:un,warn:fn("#FFA500"),error:yn,ctx:gn},yt={debug:10,info:20,warn:30,error:40},Dr=e=>fe(e)&&Object.keys(yt).some(t=>t in e),Kr=e=>e in yt,Fr=(e,t)=>yt[e]<yt[t],hn=(e,t=0)=>Intl.NumberFormat(void 0,{useGrouping:!1,minimumFractionDigits:0,maximumFractionDigits:t,style:"unit",unitDisplay:"long",unit:e}),je=Hr.memoizeWith((e,t)=>`${e}${t}`,hn),qr=e=>e<1e-6?je("nanosecond",3).format(e/1e-6):e<.001?je("nanosecond").format(e/1e-6):e<1?je("microsecond").format(e/.001):e<1e3?je("millisecond").format(e):e<6e4?je("second",2).format(e/1e3):je("minute",2).format(e/6e4);var Ve=class e{config;constructor({color:t=bn.isSupported(),level:r=ye()?"warn":"debug",depth:o=2,ctx:n={}}={}){this.config={color:t,level:r,depth:o,ctx:n}}format(t){let{depth:r,color:o,level:n}=this.config;return xn(t,{depth:r,colors:o,breakLength:n==="debug"?80:1/0,compact:n==="debug"?3:!0})}print(t,r,o){let{level:n,ctx:{requestId:s,...a},color:c}=this.config;if(n==="silent"||Fr(t,n))return;let m=[new Date().toISOString()];s&&m.push(c?Ft.ctx(s):s),m.push(c?`${Ft[t](t)}:`:`${t}:`,r),o!==void 0&&m.push(this.format(o)),Object.keys(a).length>0&&m.push(this.format(a)),console.log(m.join(" "))}debug(t,r){this.print("debug",t,r)}info(t,r){this.print("info",t,r)}warn(t,r){this.print("warn",t,r)}error(t,r){this.print("error",t,r)}child(t){return new e({...this.config,ctx:t})}get ctx(){return this.config.ctx}profile(t){let r=Br.now();return()=>{let o=Br.now()-r,{message:n,severity:s="debug",formatter:a=qr}=typeof t=="object"?t:{message:t};this.print(typeof s=="function"?s(o):s,n,a(o))}}};import*as Ne from"ramda";var Ge=class e extends Ie{#e;constructor(t){super(),this.#e=t}get entries(){let t=[],r=Ne.keys(this.#e);for(let o of r){let n=this.#e[o];n&&t.push([o,n,Ne.reject(Ne.equals(o),r)])}return Object.freeze(t)}deprecated(){let t=Object.entries(this.#e).reduce((r,[o,n])=>Object.assign(r,{[o]:n.deprecated()}),{});return new e(t)}};import Sn from"express";var Je=class{#e;constructor(...t){this.#e=t}apply(t,r){return r(t,Sn.static(...this.#e))}};import bt from"express";import kn from"node:http";import Cn from"node:https";var Me=async(e,t="default")=>{try{return(await import(e))[t]}catch{}throw new Ke(e)};import Pn from"http-errors";import*as $r from"ramda";var gt=class{constructor(t){this.logger=t}#e=$r.tryCatch(kr);#t=new WeakSet;#r=new WeakMap;checkJsonCompat(t,r){if(!this.#t.has(t)){t.requestType==="json"&&this.#e(o=>this.logger.warn("The final input schema of the endpoint contains an unsupported JSON payload type.",Object.assign(r,{reason:o})))(t.inputSchema,"in");for(let o of Ce){let n=this.#e(s=>this.logger.warn(`The final ${o} response schema of the endpoint contains an unsupported JSON payload type.`,Object.assign(r,{reason:s})));for(let{mimeTypes:s,schema:a}of t.getResponses(o))s?.includes(Z.json)&&n(a,"out")}this.#t.add(t)}}checkPathParams(t,r,o){let n=this.#r.get(r);if(n?.paths.includes(t))return;let s=ot(t);if(s.length===0)return;let{shape:a}=n||$(r.inputSchema);for(let c of s)c in a||this.logger.warn("The input schema of the endpoint is most likely missing the parameter of the path it's assigned to.",Object.assign(o,{path:t,param:c}));n?n.paths.push(t):this.#r.set(r,{shape:a,paths:[t]})}};var qt=["get","post","put","delete","patch"],_r=e=>qt.includes(e);var Rn=e=>{let[t,r]=e.trim().split(/ (.+)/,2);return r&&_r(t)?[r,t]:[e]},Tn=e=>e.trim().split("/").filter(Boolean).join("/"),Vr=(e,t)=>Object.entries(e).map(([r,o])=>{let[n,s]=Rn(r);return[[t||""].concat(Tn(n)||[]).join("/"),o,s]}),On=(e,t)=>{throw new de("Route with explicit method can only be assigned with Endpoint",e,t)},Gr=(e,t,r)=>{if(!(!r||r.includes(e)))throw new de(`Method ${e} is not supported by the assigned Endpoint.`,e,t)},Bt=(e,t,r)=>{let o=`${e} ${t}`;if(r.has(o))throw new de("Route has a duplicate",e,t);r.add(o)},Le=({routing:e,onEndpoint:t,onStatic:r})=>{let o=Vr(e),n=new Set;for(;o.length;){let[s,a,c]=o.shift();if(a instanceof _e)if(c)Bt(c,s,n),Gr(c,s,a.methods),t(a,s,c);else{let{methods:m=["get"]}=a;for(let p of m)Bt(p,s,n),t(a,s,p)}else if(c&&On(c,s),a instanceof Je)r&&a.apply(s,r);else if(a instanceof Ge)for(let[m,p,l]of a.entries){let{methods:h}=p;Bt(m,s,n),Gr(m,s,h),t(p,s,m,l)}else o.unshift(...Vr(a,s))}};var wn=e=>({method:t},r,o)=>{let n=e.join(", ").toUpperCase();r.set({Allow:n});let s=Pn(405,`${t} is not allowed`,{headers:{Allow:n}});o(s)},$t=({app:e,getLogger:t,config:r,routing:o,parsers:n})=>{let s=ye()?void 0:new gt(t()),a=new Map;if(Le({routing:o,onEndpoint:(m,p,l,h)=>{ye()||(s?.checkJsonCompat(m,{path:p,method:l}),s?.checkPathParams(p,m,{method:l}));let g=n?.[m.requestType]||[],S=async(b,k)=>{let P=t(b);if(r.cors){let R={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":[l,...h||[],"options"].join(", ").toUpperCase(),"Access-Control-Allow-Headers":"content-type"},z=typeof r.cors=="function"?await r.cors({request:b,endpoint:m,logger:P,defaultHeaders:R}):R;for(let C in z)k.set(C,z[C])}return m.execute({request:b,response:k,logger:P,config:r})};a.has(p)||(a.set(p,[]),r.cors&&(e.options(p,...g,S),a.get(p)?.push("options"))),a.get(p)?.push(l),e[l](p,...g,S)},onStatic:e.use.bind(e)}),s=void 0,r.wrongMethodBehavior!==404)for(let[m,p]of a.entries())e.all(m,wn(p))};import En from"http-errors";import{setInterval as An}from"node:timers/promises";var Jr=e=>"_httpMessage"in e&&typeof e._httpMessage=="object"&&e._httpMessage!==null&&"headersSent"in e._httpMessage&&typeof e._httpMessage.headersSent=="boolean"&&"setHeader"in e._httpMessage&&typeof e._httpMessage.setHeader=="function",Wr=e=>"server"in e&&typeof e.server=="object"&&e.server!==null&&"close"in e.server&&typeof e.server.close=="function",Yr=e=>"encrypted"in e&&typeof e.encrypted=="boolean"&&e.encrypted,Qr=({},e)=>void(!e.headersSent&&e.setHeader("connection","close")),Xr=e=>new Promise((t,r)=>void e.close(o=>o?r(o):t()));var eo=(e,{timeout:t=1e3,logger:r}={})=>{let o,n=new Set,s=p=>void n.delete(p.destroy()),a=p=>void(Jr(p)?!p._httpMessage.headersSent&&p._httpMessage.setHeader("connection","close"):s(p)),c=p=>void(o?p.destroy():n.add(p.once("close",()=>void n.delete(p))));for(let p of e)for(let l of["connection","secureConnection"])p.on(l,c);let m=async()=>{for(let p of e)p.on("request",Qr);r?.info("Graceful shutdown",{sockets:n.size,timeout:t});for(let p of n)(Yr(p)||Wr(p))&&a(p);for await(let p of An(10,Date.now()))if(n.size===0||Date.now()-p>=t)break;for(let p of n)s(p);return Promise.allSettled(e.map(Xr))};return{sockets:n,shutdown:()=>o??=m()}};var to=({errorHandler:e,getLogger:t})=>async(r,o,n,s)=>r?e.execute({error:oe(r),request:o,response:n,input:null,output:null,options:{},logger:t(o)}):s(),ro=({errorHandler:e,getLogger:t})=>async(r,o)=>{let n=En(404,`Can not ${r.method} ${r.path}`),s=t(r);try{await e.execute({request:r,response:o,logger:s,error:n,input:null,output:null,options:{}})}catch(a){ut({response:o,logger:s,error:new re(oe(a),n)})}},zn=e=>(t,{},r)=>{if(Object.values(t?.files||[]).flat().find(({truncated:n})=>n))return r(e);r()},Zn=e=>({log:e.debug.bind(e)}),oo=async({getLogger:e,config:t})=>{let r=await Me("express-fileupload"),{limitError:o,beforeUpload:n,...s}={...typeof t.upload=="object"&&t.upload},a=[];return a.push(async(c,m,p)=>{let l=e(c);return await n?.({request:c,logger:l}),r({debug:!0,...s,abortOnLimit:!1,parseNested:!0,logger:Zn(l)})(c,m,p)}),o&&a.push(zn(o)),a},no=(e,{},t)=>{Buffer.isBuffer(e.body)&&(e.body={raw:e.body}),t()},so=({logger:e,config:{childLoggerProvider:t,accessLogger:r=({method:o,path:n},s)=>s.debug(`${o}: ${n}`)}})=>async(o,n,s)=>{let a=await t?.({request:o,parent:e})||e;r?.(o,a),o.res&&(o.res.locals[y]={logger:a}),s()},io=e=>t=>t?.res?.locals[y]?.logger||e,ao=e=>process.on("deprecation",({message:t,namespace:r,name:o,stack:n})=>e.warn(`${o} (${r}): ${t}`,n.split(`
`).slice(1))),po=({servers:e,logger:t,options:{timeout:r,events:o=["SIGINT","SIGTERM"]}})=>{let n=eo(e,{logger:t,timeout:r}),s=()=>n.shutdown().then(()=>process.exit());for(let a of o)process.on(a,s)};import{gray as In,hex as co,italic as ht,whiteBright as vn}from"ansis";var mo=e=>{if(e.columns<132)return;let t=ht("Proudly supports transgender community.".padStart(109)),r=ht("Start your API server with I/O schema validation and custom middlewares in minutes.".padStart(109)),o=ht("Thank you for choosing Express Zod API for your project.".padStart(132)),n=ht("for Sonia".padEnd(20)),s=co("#F5A9B8"),a=co("#5BCEFA"),c=new Array(14).fill(a,1,3).fill(s,3,5).fill(vn,5,7).fill(s,7,9).fill(a,9,12).fill(In,12,13),m=`
8888888888                                                          8888888888P              888             d8888 8888888b. 8888888
888                                                                       d88P               888            d88888 888   Y88b  888
888                                                                      d88P                888           d88P888 888    888  888
8888888    888  888 88888b.  888d888 .d88b.  .d8888b  .d8888b           d88P    .d88b.   .d88888          d88P 888 888   d88P  888
888        \u1FEFY8bd8P' 888 "88b 888P"  d8P  Y8b 88K      88K              d88P    d88""88b d88" 888         d88P  888 8888888P"   888
888          X88K   888  888 888    88888888 "Y8888b. "Y8888b.        d88P     888  888 888  888        d88P   888 888         888
888        .d8""8b. 888 d88P 888    Y8b.          X88      X88       d88P      Y88..88P Y88b 888       d8888888888 888         888
8888888888 888  888 88888P"  888     "Y8888   88888P'  88888P'      d8888888888 "Y88P"   "Y88888      d88P     888 888       8888888
                    888
                    888${t}
${n}888${r}
${o}
`;e.write(m.split(`
`).map((p,l)=>c[l]?c[l](p):p).join(`
`))};var lo=e=>{e.startupLogo!==!1&&mo(process.stdout);let t=e.errorHandler||Re,r=Dr(e.logger)?e.logger:new Ve(e.logger);r.debug("Running",{build:"v23.4.0 (ESM)",env:process.env.NODE_ENV||"development"}),ao(r);let o=so({logger:r,config:e}),s={getLogger:io(r),errorHandler:t},a=ro(s),c=to(s);return{...s,logger:r,notFoundHandler:a,catcher:c,loggingMiddleware:o}},jn=(e,t)=>{let{logger:r,getLogger:o,notFoundHandler:n,loggingMiddleware:s}=lo(e);return $t({app:e.app.use(s),routing:t,getLogger:o,config:e}),{notFoundHandler:n,logger:r}},Nn=async(e,t)=>{let{logger:r,getLogger:o,notFoundHandler:n,catcher:s,loggingMiddleware:a}=lo(e),c=bt().disable("x-powered-by").use(a);if(e.compression){let g=await Me("compression");c.use(g(typeof e.compression=="object"?e.compression:void 0))}await e.beforeRouting?.({app:c,getLogger:o});let m={json:[e.jsonParser||bt.json()],raw:[e.rawParser||bt.raw(),no],form:[e.formParser||bt.urlencoded()],upload:e.upload?await oo({config:e,getLogger:o}):[]};$t({app:c,routing:t,getLogger:o,config:e,parsers:m}),c.use(s,n);let p=[],l=(g,S)=>()=>g.listen(S,()=>r.info("Listening",S)),h=[];if(e.http){let g=kn.createServer(c);p.push(g),h.push(l(g,e.http.listen))}if(e.https){let g=Cn.createServer(e.https.options,c);p.push(g),h.push(l(g,e.https.listen))}return e.gracefulShutdown&&po({logger:r,servers:p,options:e.gracefulShutdown===!0?{}:e.gracefulShutdown}),{app:c,logger:r,servers:h.map(g=>g())}};import{OpenApiBuilder as Zs}from"openapi3-ts/oas31";import*as No from"ramda";import*as T from"ramda";var uo=e=>fe(e)&&"or"in e,fo=e=>fe(e)&&"and"in e,_t=e=>!fo(e)&&!uo(e),yo=e=>{let t=T.filter(_t,e),r=T.chain(T.prop("and"),T.filter(fo,e)),[o,n]=T.partition(_t,r),s=T.concat(t,o),a=T.filter(uo,e);return T.map(T.prop("or"),T.concat(a,n)).reduce((m,p)=>ue(m,T.map(l=>_t(l)?[l]:l.and,p),([l,h])=>T.concat(l,h)),T.reject(T.isEmpty,[s]))};import{isReferenceObject as Vt,isSchemaObject as St}from"openapi3-ts/oas31";import*as d from"ramda";import{z as K}from"zod";var Oe=(e,{onEach:t,rules:r,onMissing:o,ctx:n={}})=>{let s=r[e._def[y]?.brand]||"typeName"in e._def&&r[e._def.typeName],c=s?s(e,{...n,next:p=>Oe(p,{ctx:n,onEach:t,rules:r,onMissing:o})}):o(e,n),m=t&&t(e,{prev:c,...n});return m?{...c,...m}:c};var go=["a-im","accept","accept-additions","accept-ch","accept-charset","accept-datetime","accept-encoding","accept-features","accept-language","accept-signature","access-control","access-control-request-headers","access-control-request-method","alpn","alt-used","alternates","amp-cache-transform","apply-to-redirect-ref","authentication-control","authentication-info","authorization","available-dictionary","c-ext","c-man","c-opt","c-pep","c-pep-info","cache-control","cal-managed-id","caldav-timezones","capsule-protocol","cert-not-after","cert-not-before","client-cert","client-cert-chain","close","cmcd-object","cmcd-request","cmcd-session","cmcd-status","cmsd-dynamic","cmsd-static","concealed-auth-export","configuration-context","connection","content-digest","content-disposition","content-encoding","content-id","content-language","content-length","content-location","content-md5","content-range","content-script-type","content-type","cookie","cookie2","cross-origin-embedder-policy","cross-origin-embedder-policy-report-only","cross-origin-opener-policy","cross-origin-opener-policy-report-only","cross-origin-resource-policy","cta-common-access-token","dasl","date","dav","default-style","delta-base","deprecation","depth","derived-from","destination","detached-jws","differential-id","dictionary-id","digest","dpop","dpop-nonce","early-data","ediint-features","expect","expect-ct","ext","forwarded","from","getprofile","hobareg","host","http2-settings","if","if-match","if-modified-since","if-none-match","if-range","if-schedule-tag-match","if-unmodified-since","im","include-referred-token-binding-id","isolation","keep-alive","label","last-event-id","link","link-template","lock-token","man","max-forwards","memento-datetime","meter","method-check","method-check-expires","mime-version","negotiate","nel","odata-entityid","odata-isolation","odata-maxversion","odata-version","opt","ordering-type","origin","origin-agent-cluster","oscore","oslc-core-version","overwrite","p3p","pep","pep-info","permissions-policy","pics-label","ping-from","ping-to","position","pragma","prefer","preference-applied","priority","profileobject","protocol","protocol-info","protocol-query","protocol-request","proxy-authorization","proxy-features","proxy-instruction","public","public-key-pins","public-key-pins-report-only","range","redirect-ref","referer","referer-root","referrer-policy","repeatability-client-id","repeatability-first-sent","repeatability-request-id","repeatability-result","replay-nonce","reporting-endpoints","repr-digest","safe","schedule-reply","schedule-tag","sec-fetch-storage-access","sec-gpc","sec-purpose","sec-token-binding","sec-websocket-extensions","sec-websocket-key","sec-websocket-protocol","sec-websocket-version","security-scheme","setprofile","signature","signature-input","slug","soapaction","status-uri","sunset","surrogate-capability","tcn","te","timeout","topic","traceparent","tracestate","trailer","transfer-encoding","ttl","upgrade","urgency","uri","use-as-dictionary","user-agent","variant-vary","via","want-content-digest","want-digest","want-repr-digest","warning","x-content-type-options","x-frame-options"];var ho=50,xo="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString",So={integer:0,number:0,string:"",boolean:!1,object:{},null:null,array:[]},Ln=/^\d{4}-\d{2}-\d{2}$/,Un=/^\d{2}:\d{2}:\d{2}(\.\d+)?$/,Hn=e=>e?/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(([+-]\d{2}:\d{2})|Z)$/:/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?Z$/,Ro=e=>e.replace(jt,t=>`{${t.slice(1)}}`),Dn=({_def:e},{next:t})=>({...t(e.innerType),default:e[y]?.defaultLabel||e.defaultValue()}),Kn=({_def:{innerType:e}},{next:t})=>t(e),Fn=()=>({format:"any"}),qn=({},e)=>{if(e.isResponse)throw new B("Please use ez.upload() only for input.",e);return{type:"string",format:"binary"}},Bn=e=>{let t=e.unwrap();return{type:"string",format:t instanceof K.ZodString?t._def.checks.find(r=>r.kind==="base64")?"byte":"file":"binary"}},$n=({options:e},{next:t})=>({oneOf:e.map(t)}),_n=({options:e,discriminator:t},{next:r})=>({discriminator:{propertyName:t},oneOf:e.map(r)}),Vn=(e,t)=>{if(Array.isArray(e)&&Array.isArray(t))return d.concat(e,t);if(e===t)return t;throw new Error("Can not flatten properties")},To={type:d.always("object"),properties:({properties:e={}},{properties:t={}})=>d.mergeDeepWith(Vn,e,t),required:({required:e=[]},{required:t=[]})=>d.union(e,t),examples:({examples:e=[]},{examples:t=[]})=>ue(e,t,([r,o])=>d.mergeDeepRight(r,o))},Gn=d.both(({type:e})=>e==="object",d.pipe(Object.keys,d.without(Object.keys(To)),d.isEmpty)),Jn=d.tryCatch(e=>{let[t,r]=e.filter(St).filter(Gn);if(!t||!r)throw new Error("Can not flatten objects");let o=d.pickBy((n,s)=>(t[s]||r[s])!==void 0,To);return d.map(n=>n(t,r),o)},(e,t)=>({allOf:t})),Wn=({_def:{left:e,right:t}},{next:r})=>Jn([e,t].map(r)),Yn=(e,{next:t})=>t(e.unwrap()),Qn=(e,{next:t})=>t(e.unwrap()),Xn=(e,{next:t})=>{let r=t(e.unwrap());return St(r)&&(r.type=Po(r)),r},es=e=>e in So,Oo=e=>{let t=d.toLower(d.type(e));return typeof e=="bigint"?"integer":es(t)?t:void 0},bo=e=>({type:Oo(Object.values(e.enum)[0]),enum:Object.values(e.enum)}),ts=({value:e})=>({type:Oo(e),const:e}),rs=(e,{isResponse:t,next:r})=>{let o=Object.keys(e.shape),n=c=>t?c instanceof K.ZodOptional:c.isOptional(),s=o.filter(c=>!n(e.shape[c])),a={type:"object"};return o.length&&(a.properties=xt(e,r)),s.length&&(a.required=s),a},os=()=>({type:"null"}),ns=({},e)=>{if(e.isResponse)throw new B("Please use ez.dateOut() for output.",e);return{description:"YYYY-MM-DDTHH:mm:ss.sssZ",type:"string",format:"date-time",pattern:/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(\.\d+)?)?Z?$/.source,externalDocs:{url:xo}}},ss=({},e)=>{if(!e.isResponse)throw new B("Please use ez.dateIn() for input.",e);return{description:"YYYY-MM-DDTHH:mm:ss.sssZ",type:"string",format:"date-time",externalDocs:{url:xo}}},is=({},e)=>{throw new B(`Using z.date() within ${e.isResponse?"output":"input"} schema is forbidden. Please use ez.date${e.isResponse?"Out":"In"}() instead. Check out the documentation for details.`,e)},as=()=>({type:"boolean"}),ps=()=>({type:"integer",format:"bigint"}),cs=e=>e.every(t=>t instanceof K.ZodLiteral),ds=({keySchema:e,valueSchema:t},{next:r})=>{if(e instanceof K.ZodEnum||e instanceof K.ZodNativeEnum){let o=Object.values(e.enum),n={type:"object"};return o.length&&(n.properties=xt(K.object(d.fromPairs(d.xprod(o,[t]))),r),n.required=o),n}if(e instanceof K.ZodLiteral)return{type:"object",properties:xt(K.object({[e.value]:t}),r),required:[e.value]};if(e instanceof K.ZodUnion&&cs(e.options)){let o=d.map(s=>`${s.value}`,e.options),n=d.fromPairs(d.xprod(o,[t]));return{type:"object",properties:xt(K.object(n),r),required:o}}return{type:"object",propertyNames:r(e),additionalProperties:r(t)}},ms=({_def:{minLength:e,maxLength:t,exactLength:r},element:o},{next:n})=>{let s={type:"array",items:n(o)};return r&&([s.minItems,s.maxItems]=Array(2).fill(r.value)),e&&(s.minItems=e.value),t&&(s.maxItems=t.value),s},ls=({items:e,_def:{rest:t}},{next:r})=>({type:"array",prefixItems:e.map(r),items:t===null?{not:{}}:r(t)}),us=({isEmail:e,isURL:t,minLength:r,maxLength:o,isUUID:n,isCUID:s,isCUID2:a,isULID:c,isIP:m,isEmoji:p,isDatetime:l,isCIDR:h,isDate:g,isTime:S,isBase64:b,isNANOID:k,isBase64url:P,isDuration:V,_def:{checks:M}})=>{let R=M.find(v=>v.kind==="regex"),z=M.find(v=>v.kind==="datetime"),C=M.some(v=>v.kind==="jwt"),L=M.find(v=>v.kind==="length"),O={type:"string"},q={"date-time":l,byte:b,base64url:P,date:g,time:S,duration:V,email:e,url:t,uuid:n,cuid:s,cuid2:a,ulid:c,nanoid:k,jwt:C,ip:m,cidr:h,emoji:p};for(let v in q)if(q[v]){O.format=v;break}return L&&([O.minLength,O.maxLength]=[L.value,L.value]),r!==null&&(O.minLength=r),o!==null&&(O.maxLength=o),g&&(O.pattern=Ln.source),S&&(O.pattern=Un.source),l&&(O.pattern=Hn(z?.offset).source),R&&(O.pattern=R.regex.source),O},fs=({isInt:e,maxValue:t,minValue:r,_def:{checks:o}},{numericRange:n={integer:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],float:[-Number.MAX_VALUE,Number.MAX_VALUE]}})=>{let{integer:s,float:a}=n||{integer:null,float:null},c=o.find(b=>b.kind==="min"),m=r===null?e?s?.[0]:a?.[0]:r,p=c?c.inclusive:!0,l=o.find(b=>b.kind==="max"),h=t===null?e?s?.[1]:a?.[1]:t,g=l?l.inclusive:!0,S={type:e?"integer":"number",format:e?"int64":"double"};return p?S.minimum=m:S.exclusiveMinimum=m,g?S.maximum=h:S.exclusiveMaximum=h,S},xt=({shape:e},t)=>d.map(t,e),ys=e=>{let t=Array.isArray(e.type)?e.type[0]:e.type;return So?.[t]},Po=({type:e})=>e==="null"?e:typeof e=="string"?[e,"null"]:e?[...new Set(e).add("null")]:"null",gs=(e,{isResponse:t,next:r})=>{let o=r(e.innerType()),{effect:n}=e._def;if(t&&n.type==="transform"&&St(o)){let s=st(e,ys(o));return s&&["number","string","boolean"].includes(s)?{type:s}:r(K.any())}if(!t&&n.type==="preprocess"&&St(o)){let{type:s,...a}=o;return{...a,format:`${a.format||s} (preprocessed)`}}return o},hs=({_def:e},{isResponse:t,next:r})=>r(e[t?"out":"in"]),bs=(e,{next:t})=>t(e.unwrap()),xs=(e,{next:t,makeRef:r})=>r(e,()=>t(e.schema)),Ss=(e,{next:t})=>t(e.unwrap().shape.raw),wo=e=>e.length?d.fromPairs(d.zip(d.times(t=>`example${t+1}`,e.length),d.map(d.objOf("value"),e))):void 0,Ao=(e,t,r=[])=>d.pipe(ne,d.map(d.when(o=>d.type(o)==="Object",d.omit(r))),wo)({schema:e,variant:t?"parsed":"original",validate:!0,pullProps:!0}),Rs=(e,t)=>d.pipe(ne,d.filter(d.has(t)),d.pluck(t),wo)({schema:e,variant:"original",validate:!0,pullProps:!0}),Ts=(e,t)=>t?.includes(e)||e.startsWith("x-")||go.includes(e),Eo=({path:e,method:t,schema:r,inputSources:o,makeRef:n,composition:s,brandHandling:a,isHeader:c,security:m,numericRange:p,description:l=`${t.toUpperCase()} ${e} Parameter`})=>{let h=$(r),g=ot(e),S=o.includes("query"),b=o.includes("params"),k=o.includes("headers"),P=R=>b&&g.includes(R),V=d.chain(d.filter(R=>R.type==="header"),m??[]).map(({name:R})=>R),M=R=>k&&(c?.(R,t,e)??Ts(R,V));return Object.entries(h.shape).reduce((R,[z,C])=>{let L=P(z)?"path":M(z)?"header":S?"query":void 0;if(!L)return R;let O=Oe(C,{rules:{...a,...Gt},onEach:Jt,onMissing:Wt,ctx:{isResponse:!1,makeRef:n,path:e,method:t,numericRange:p}}),q=s==="components"?n(C,O,se(l,z)):O,{_def:v}=C;return R.concat({name:z,in:L,deprecated:v[y]?.isDeprecated,required:!C.isOptional(),description:O.description||l,schema:q,examples:Rs(h,z)})},[])},Gt={ZodString:us,ZodNumber:fs,ZodBigInt:ps,ZodBoolean:as,ZodNull:os,ZodArray:ms,ZodTuple:ls,ZodRecord:ds,ZodObject:rs,ZodLiteral:ts,ZodIntersection:Wn,ZodUnion:$n,ZodAny:Fn,ZodDefault:Dn,ZodEnum:bo,ZodNativeEnum:bo,ZodEffects:gs,ZodOptional:Yn,ZodNullable:Xn,ZodDiscriminatedUnion:_n,ZodBranded:bs,ZodDate:is,ZodCatch:Kn,ZodPipeline:hs,ZodLazy:xs,ZodReadonly:Qn,[G]:Bn,[Ee]:qn,[he]:ss,[ge]:ns,[ie]:Ss},Jt=(e,{isResponse:t,prev:r})=>{if(Vt(r))return{};let{description:o,_def:n}=e,s=e instanceof K.ZodLazy,a=r.type!==void 0,c=!t&&!s&&a&&e.isNullable(),m={};if(o&&(m.description=o),n[y]?.isDeprecated&&(m.deprecated=!0),c&&(m.type=Po(r)),!s){let p=ne({schema:e,variant:t?"parsed":"original",validate:!0});p.length&&(m.examples=p.slice())}return m},Wt=(e,t)=>{throw new B(`Zod type ${e.constructor.name} is unsupported.`,t)},zo=(e,t)=>{if(Vt(e))return[e,!1];let r=!1,o=d.map(c=>{let[m,p]=zo(c,t);return r=r||p,m}),n=d.omit(t),s={properties:n,examples:d.map(n),required:d.without(t),allOf:o,oneOf:o},a=d.evolve(s,e);return[a,r||!!a.required?.length]},Zo=e=>Vt(e)?e:d.omit(["examples"],e),Io=({method:e,path:t,schema:r,mimeTypes:o,variant:n,makeRef:s,composition:a,hasMultipleStatusCodes:c,statusCode:m,brandHandling:p,numericRange:l,description:h=`${e.toUpperCase()} ${t} ${Lt(n)} response ${c?m:""}`.trim()})=>{if(!o)return{description:h};let g=Zo(Oe(r,{rules:{...p,...Gt},onEach:Jt,onMissing:Wt,ctx:{isResponse:!0,makeRef:s,path:t,method:e,numericRange:l}})),S={schema:a==="components"?s(r,g,se(h)):g,examples:Ao(r,!0)};return{description:h,content:d.fromPairs(d.xprod(o,[S]))}},Os=({format:e})=>{let t={type:"http",scheme:"bearer"};return e&&(t.bearerFormat=e),t},Ps=({name:e},t)=>{let r={type:"apiKey",in:"query",name:e};return t?.includes("body")&&(t?.includes("query")?(r["x-in-alternative"]="body",r.description=`${e} CAN also be supplied within the request body`):(r["x-in-actual"]="body",r.description=`${e} MUST be supplied within the request body instead of query`)),r},ws=({name:e})=>({type:"apiKey",in:"header",name:e}),As=({name:e})=>({type:"apiKey",in:"cookie",name:e}),Es=({url:e})=>({type:"openIdConnect",openIdConnectUrl:e}),zs=({flows:e={}})=>({type:"oauth2",flows:d.map(t=>({...t,scopes:t.scopes||{}}),d.reject(d.isNil,e))}),vo=(e,t=[])=>{let r=o=>o.type==="basic"?{type:"http",scheme:"basic"}:o.type==="bearer"?Os(o):o.type==="input"?Ps(o,t):o.type==="header"?ws(o):o.type==="cookie"?As(o):o.type==="openid"?Es(o):zs(o);return e.map(o=>o.map(r))},ko=(e,t,r)=>e.map(o=>o.reduce((n,s)=>{let a=r(s),c=["oauth2","openIdConnect"].includes(s.type);return Object.assign(n,{[a]:c?t:[]})},{})),Co=({method:e,path:t,schema:r,mimeType:o,makeRef:n,composition:s,brandHandling:a,paramNames:c,numericRange:m,description:p=`${e.toUpperCase()} ${t} Request body`})=>{let[l,h]=zo(Oe(r,{rules:{...a,...Gt},onEach:Jt,onMissing:Wt,ctx:{isResponse:!1,makeRef:n,path:t,method:e,numericRange:m}}),c),g=Zo(l),S={schema:s==="components"?n(r,g,se(p)):g,examples:Ao($(r),!1,c)},b={description:p,content:{[o]:S}};return(h||o===Z.raw)&&(b.required=!0),b},jo=e=>Object.entries(e).reduce((t,[r,o])=>{if(!o)return t;let n={name:r,description:typeof o=="string"?o:o.description};return typeof o=="object"&&o.url&&(n.externalDocs={url:o.url}),t.concat(n)},[]),Yt=e=>e.length<=ho?e:e.slice(0,ho-1)+"\u2026",Rt=e=>e.length?e.slice():void 0;var Qt=class extends Zs{#e=new Map;#t=new Map;#r=new Map;#o(t,r,o=this.#r.get(t)){return o||(o=`Schema${this.#r.size+1}`,this.#r.set(t,o),typeof r=="function"&&(r=r())),typeof r=="object"&&this.addSchema(o,r),{$ref:`#/components/schemas/${o}`}}#n(t,r,o){let n=o||se(r,t),s=this.#t.get(n);if(s===void 0)return this.#t.set(n,1),n;if(o)throw new B(`Duplicated operationId: "${o}"`,{method:r,isResponse:!1,path:t});return s++,this.#t.set(n,s),`${n}${s}`}#s(t){let r=JSON.stringify(t);for(let n in this.rootDoc.components?.securitySchemes||{})if(r===JSON.stringify(this.rootDoc.components?.securitySchemes?.[n]))return n;let o=(this.#e.get(t.type)||0)+1;return this.#e.set(t.type,o),`${t.type.toUpperCase()}_${o}`}constructor({routing:t,config:r,title:o,version:n,serverUrl:s,descriptions:a,brandHandling:c,tags:m,isHeader:p,numericRange:l,hasSummaryFromDescription:h=!0,composition:g="inline"}){super(),this.addInfo({title:o,version:n});for(let b of typeof s=="string"?[s]:s)this.addServer({url:b});Le({routing:t,onEndpoint:(b,k,P)=>{let V={path:k,method:P,endpoint:b,composition:g,brandHandling:c,numericRange:l,makeRef:this.#o.bind(this)},{description:M,shortDescription:R,scopes:z,inputSchema:C}=b,L=R?Yt(R):h&&M?Yt(M):void 0,O=r.inputSources?.[P]||Nt[P],q=this.#n(k,P,b.getOperationId(P)),v=yo(b.security),pe=Eo({...V,inputSources:O,isHeader:p,security:v,schema:C,description:a?.requestParameter?.call(null,{method:P,path:k,operationId:q})}),Qe={};for(let te of Ce){let ce=b.getResponses(te);for(let{mimeTypes:kt,schema:et,statusCodes:tt}of ce)for(let Ct of tt)Qe[Ct]=Io({...V,variant:te,schema:et,mimeTypes:kt,statusCode:Ct,hasMultipleStatusCodes:ce.length>1||tt.length>1,description:a?.[`${te}Response`]?.call(null,{method:P,path:k,operationId:q,statusCode:Ct})})}let It=O.includes("body")?Co({...V,paramNames:No.pluck("name",pe),schema:C,mimeType:Z[b.requestType],description:a?.requestBody?.call(null,{method:P,path:k,operationId:q})}):void 0,Xe=ko(vo(v,O),z,te=>{let ce=this.#s(te);return this.addSecurityScheme(ce,te),ce}),vt={operationId:q,summary:L,description:M,deprecated:b.isDeprecated||void 0,tags:Rt(b.tags),parameters:Rt(pe),requestBody:It,security:Rt(Xe),responses:Qe};this.addPath(Ro(k),{[P]:vt})}}),m&&(this.rootDoc.tags=jo(m))}};import{createRequest as Is,createResponse as vs}from"node-mocks-http";var ks=e=>Is({...e,headers:{"content-type":Z.json,...e?.headers}}),Cs=e=>vs(e),js=e=>{let t={warn:[],error:[],info:[],debug:[]};return new Proxy(e||{},{get(r,o,n){return o==="_getLogs"?()=>t:Kr(o)?(...s)=>t[o].push(s):Reflect.get(r,o,n)}})},Mo=({requestProps:e,responseOptions:t,configProps:r,loggerProps:o})=>{let n=ks(e),s=Cs({req:n,...t});s.req=t?.req||n,n.res=s;let a=js(o),c={cors:!1,logger:a,...r};return{requestMock:n,responseMock:s,loggerMock:a,configMock:c}},Ns=async({endpoint:e,...t})=>{let{requestMock:r,responseMock:o,loggerMock:n,configMock:s}=Mo(t);return await e.execute({request:r,response:o,config:s,logger:n}),{requestMock:r,responseMock:o,loggerMock:n}},Ms=async({middleware:e,options:t={},...r})=>{let{requestMock:o,responseMock:n,loggerMock:s,configMock:{inputSources:a,errorHandler:c=Re}}=Mo(r),m=nt(o,a),p={request:o,response:n,logger:s,input:m,options:t};try{let l=await e.execute(p);return{requestMock:o,responseMock:n,loggerMock:s,output:l}}catch(l){return await c.execute({...p,error:oe(l),output:null}),{requestMock:o,responseMock:n,loggerMock:s,output:{}}}};import*as Fo from"ramda";import Zt from"typescript";import{z as di}from"zod";import*as Do from"ramda";import X from"typescript";import*as Y from"ramda";import u from"typescript";var i=u.factory,Tt=[i.createModifier(u.SyntaxKind.ExportKeyword)],Ls=[i.createModifier(u.SyntaxKind.AsyncKeyword)],We={public:[i.createModifier(u.SyntaxKind.PublicKeyword)],protectedReadonly:[i.createModifier(u.SyntaxKind.ProtectedKeyword),i.createModifier(u.SyntaxKind.ReadonlyKeyword)]},Xt=(e,t)=>u.addSyntheticLeadingComment(e,u.SyntaxKind.MultiLineCommentTrivia,`* ${t} `,!0),er=(e,t)=>{let r=u.createSourceFile("print.ts","",u.ScriptTarget.Latest,!1,u.ScriptKind.TS);return u.createPrinter(t).printNode(u.EmitHint.Unspecified,e,r)},Us=/^[A-Za-z_$][A-Za-z0-9_$]*$/,tr=e=>typeof e=="string"&&Us.test(e)?i.createIdentifier(e):E(e),Ot=(e,...t)=>i.createTemplateExpression(i.createTemplateHead(e),t.map(([r,o=""],n)=>i.createTemplateSpan(r,n===t.length-1?i.createTemplateTail(o):i.createTemplateMiddle(o)))),Pt=(e,{type:t,mod:r,init:o,optional:n}={})=>i.createParameterDeclaration(r,void 0,e,n?i.createToken(u.SyntaxKind.QuestionToken):void 0,t?f(t):void 0,o),Ue=e=>Object.entries(e).map(([t,r])=>Pt(t,typeof r=="string"||typeof r=="number"||typeof r=="object"&&"kind"in r?{type:r}:r)),rr=(e,t=[])=>i.createConstructorDeclaration(We.public,e,i.createBlock(t)),f=(e,t)=>typeof e=="number"?i.createKeywordTypeNode(e):typeof e=="string"||u.isIdentifier(e)?i.createTypeReferenceNode(e,t&&Y.map(f,t)):e,or=f("Record",[u.SyntaxKind.StringKeyword,u.SyntaxKind.AnyKeyword]),Pe=(e,t,{isOptional:r,isDeprecated:o,comment:n}={})=>{let s=i.createPropertySignature(void 0,tr(e),r?i.createToken(u.SyntaxKind.QuestionToken):void 0,f(t)),a=Y.reject(Y.isNil,[o?"@deprecated":void 0,n]);return a.length?Xt(s,a.join(" ")):s},nr=e=>u.setEmitFlags(e,u.EmitFlags.SingleLine),sr=(...e)=>i.createArrayBindingPattern(e.map(t=>i.createBindingElement(void 0,void 0,t))),j=(e,t,{type:r,expose:o}={})=>i.createVariableStatement(o&&Tt,i.createVariableDeclarationList([i.createVariableDeclaration(e,void 0,r?f(r):void 0,t)],u.NodeFlags.Const)),ir=(e,t)=>Q(e,i.createUnionTypeNode(Y.map(D,t)),{expose:!0}),Q=(e,t,{expose:r,comment:o,params:n}={})=>{let s=i.createTypeAliasDeclaration(r?Tt:void 0,e,n&&dr(n),t);return o?Xt(s,o):s},Lo=(e,t)=>i.createPropertyDeclaration(We.public,e,void 0,f(t),void 0),ar=(e,t,r,{typeParams:o,returns:n}={})=>i.createMethodDeclaration(We.public,void 0,e,void 0,o&&dr(o),t,n,i.createBlock(r)),pr=(e,t,{typeParams:r}={})=>i.createClassDeclaration(Tt,e,r&&dr(r),void 0,t),cr=e=>i.createTypeOperatorNode(u.SyntaxKind.KeyOfKeyword,f(e)),wt=e=>f(Promise.name,[e]),At=(e,t,{expose:r,comment:o}={})=>{let n=i.createInterfaceDeclaration(r?Tt:void 0,e,void 0,void 0,t);return o?Xt(n,o):n},dr=e=>(Array.isArray(e)?e.map(t=>Y.pair(t,void 0)):Object.entries(e)).map(([t,r])=>{let{type:o,init:n}=typeof r=="object"&&"init"in r?r:{type:r};return i.createTypeParameterDeclaration([],t,o?f(o):void 0,n?f(n):void 0)}),we=(e,t,{isAsync:r}={})=>i.createArrowFunction(r?Ls:void 0,void 0,Array.isArray(e)?Y.map(Pt,e):Ue(e),void 0,void 0,t),w=e=>e,Ye=(e,t,r)=>i.createConditionalExpression(e,i.createToken(u.SyntaxKind.QuestionToken),t,i.createToken(u.SyntaxKind.ColonToken),r),A=(e,...t)=>(...r)=>i.createCallExpression(t.reduce((o,n)=>typeof n=="string"||u.isIdentifier(n)?i.createPropertyAccessExpression(o,n):i.createElementAccessExpression(o,n),typeof e=="string"?i.createIdentifier(e):e),void 0,r),He=(e,...t)=>i.createNewExpression(i.createIdentifier(e),void 0,t),Et=(e,t)=>f("Extract",[e,t]),mr=(e,t)=>i.createExpressionStatement(i.createBinaryExpression(e,i.createToken(u.SyntaxKind.EqualsToken),t)),_=(e,t)=>i.createIndexedAccessTypeNode(f(e),f(t)),Uo=e=>i.createUnionTypeNode([f(e),wt(e)]),lr=(e,t)=>i.createFunctionTypeNode(void 0,Ue(e),f(t)),E=e=>typeof e=="number"?i.createNumericLiteral(e):typeof e=="boolean"?e?i.createTrue():i.createFalse():e===null?i.createNull():i.createStringLiteral(e),D=e=>i.createLiteralTypeNode(E(e)),Hs=[u.SyntaxKind.AnyKeyword,u.SyntaxKind.BigIntKeyword,u.SyntaxKind.BooleanKeyword,u.SyntaxKind.NeverKeyword,u.SyntaxKind.NumberKeyword,u.SyntaxKind.ObjectKeyword,u.SyntaxKind.StringKeyword,u.SyntaxKind.SymbolKeyword,u.SyntaxKind.UndefinedKeyword,u.SyntaxKind.UnknownKeyword,u.SyntaxKind.VoidKeyword],Ho=e=>Hs.includes(e.kind);var zt=class{constructor(t){this.serverUrl=t}paths=new Set;tags=new Map;registry=new Map;#e={pathType:i.createIdentifier("Path"),implementationType:i.createIdentifier("Implementation"),keyParameter:i.createIdentifier("key"),pathParameter:i.createIdentifier("path"),paramsArgument:i.createIdentifier("params"),ctxArgument:i.createIdentifier("ctx"),methodParameter:i.createIdentifier("method"),requestParameter:i.createIdentifier("request"),eventParameter:i.createIdentifier("event"),dataParameter:i.createIdentifier("data"),handlerParameter:i.createIdentifier("handler"),msgParameter:i.createIdentifier("msg"),parseRequestFn:i.createIdentifier("parseRequest"),substituteFn:i.createIdentifier("substitute"),provideMethod:i.createIdentifier("provide"),onMethod:i.createIdentifier("on"),implementationArgument:i.createIdentifier("implementation"),hasBodyConst:i.createIdentifier("hasBody"),undefinedValue:i.createIdentifier("undefined"),responseConst:i.createIdentifier("response"),restConst:i.createIdentifier("rest"),searchParamsConst:i.createIdentifier("searchParams"),defaultImplementationConst:i.createIdentifier("defaultImplementation"),clientConst:i.createIdentifier("client"),contentTypeConst:i.createIdentifier("contentType"),isJsonConst:i.createIdentifier("isJSON"),sourceProp:i.createIdentifier("source")};interfaces={input:i.createIdentifier("Input"),positive:i.createIdentifier("PositiveResponse"),negative:i.createIdentifier("NegativeResponse"),encoded:i.createIdentifier("EncodedResponse"),response:i.createIdentifier("Response")};methodType=ir("Method",qt);someOfType=Q("SomeOf",_("T",cr("T")),{params:["T"]});requestType=Q("Request",cr(this.interfaces.input),{expose:!0});someOf=({name:t})=>f(this.someOfType.name,[t]);makePathType=()=>ir(this.#e.pathType,Array.from(this.paths));makePublicInterfaces=()=>Object.keys(this.interfaces).map(t=>At(this.interfaces[t],Array.from(this.registry).map(([r,{store:o,isDeprecated:n}])=>Pe(r,o[t],{isDeprecated:n})),{expose:!0}));makeEndpointTags=()=>j("endpointTags",i.createObjectLiteralExpression(Array.from(this.tags).map(([t,r])=>i.createPropertyAssignment(tr(t),i.createArrayLiteralExpression(Do.map(E,r))))),{expose:!0});makeImplementationType=()=>Q(this.#e.implementationType,lr({[this.#e.methodParameter.text]:this.methodType.name,[this.#e.pathParameter.text]:X.SyntaxKind.StringKeyword,[this.#e.paramsArgument.text]:or,[this.#e.ctxArgument.text]:{optional:!0,type:"T"}},wt(X.SyntaxKind.AnyKeyword)),{expose:!0,params:{T:{init:X.SyntaxKind.UnknownKeyword}}});makeParseRequestFn=()=>j(this.#e.parseRequestFn,we({[this.#e.requestParameter.text]:X.SyntaxKind.StringKeyword},i.createAsExpression(A(this.#e.requestParameter,w("split"))(i.createRegularExpressionLiteral("/ (.+)/"),E(2)),i.createTupleTypeNode([f(this.methodType.name),f(this.#e.pathType)]))));makeSubstituteFn=()=>j(this.#e.substituteFn,we({[this.#e.pathParameter.text]:X.SyntaxKind.StringKeyword,[this.#e.paramsArgument.text]:or},i.createBlock([j(this.#e.restConst,i.createObjectLiteralExpression([i.createSpreadAssignment(this.#e.paramsArgument)])),i.createForInStatement(i.createVariableDeclarationList([i.createVariableDeclaration(this.#e.keyParameter)],X.NodeFlags.Const),this.#e.paramsArgument,i.createBlock([mr(this.#e.pathParameter,A(this.#e.pathParameter,w("replace"))(Ot(":",[this.#e.keyParameter]),we([],i.createBlock([i.createExpressionStatement(i.createDeleteExpression(i.createElementAccessExpression(this.#e.restConst,this.#e.keyParameter))),i.createReturnStatement(i.createElementAccessExpression(this.#e.paramsArgument,this.#e.keyParameter))]))))])),i.createReturnStatement(i.createAsExpression(i.createArrayLiteralExpression([this.#e.pathParameter,this.#e.restConst]),f("const")))])));#t=()=>ar(this.#e.provideMethod,Ue({[this.#e.requestParameter.text]:"K",[this.#e.paramsArgument.text]:_(this.interfaces.input,"K"),[this.#e.ctxArgument.text]:{optional:!0,type:"T"}}),[j(sr(this.#e.methodParameter,this.#e.pathParameter),A(this.#e.parseRequestFn)(this.#e.requestParameter)),i.createReturnStatement(A(i.createThis(),this.#e.implementationArgument)(this.#e.methodParameter,i.createSpreadElement(A(this.#e.substituteFn)(this.#e.pathParameter,this.#e.paramsArgument)),this.#e.ctxArgument))],{typeParams:{K:this.requestType.name},returns:wt(_(this.interfaces.response,"K"))});makeClientClass=t=>pr(t,[rr([Pt(this.#e.implementationArgument,{type:f(this.#e.implementationType,["T"]),mod:We.protectedReadonly,init:this.#e.defaultImplementationConst})]),this.#t()],{typeParams:["T"]});#r=t=>Ot("?",[He(URLSearchParams.name,t)]);#o=()=>He(URL.name,Ot("",[this.#e.pathParameter],[this.#e.searchParamsConst]),E(this.serverUrl));makeDefaultImplementation=()=>{let t=i.createPropertyAssignment(w("method"),A(this.#e.methodParameter,w("toUpperCase"))()),r=i.createPropertyAssignment(w("headers"),Ye(this.#e.hasBodyConst,i.createObjectLiteralExpression([i.createPropertyAssignment(E("Content-Type"),E(Z.json))]),this.#e.undefinedValue)),o=i.createPropertyAssignment(w("body"),Ye(this.#e.hasBodyConst,A(JSON[Symbol.toStringTag],w("stringify"))(this.#e.paramsArgument),this.#e.undefinedValue)),n=j(this.#e.responseConst,i.createAwaitExpression(A(fetch.name)(this.#o(),i.createObjectLiteralExpression([t,r,o])))),s=j(this.#e.hasBodyConst,i.createLogicalNot(A(i.createArrayLiteralExpression([E("get"),E("delete")]),w("includes"))(this.#e.methodParameter))),a=j(this.#e.searchParamsConst,Ye(this.#e.hasBodyConst,E(""),this.#r(this.#e.paramsArgument))),c=j(this.#e.contentTypeConst,A(this.#e.responseConst,w("headers"),w("get"))(E("content-type"))),m=i.createIfStatement(i.createPrefixUnaryExpression(X.SyntaxKind.ExclamationToken,this.#e.contentTypeConst),i.createReturnStatement()),p=j(this.#e.isJsonConst,A(this.#e.contentTypeConst,w("startsWith"))(E(Z.json))),l=i.createReturnStatement(A(this.#e.responseConst,Ye(this.#e.isJsonConst,E(w("json")),E(w("text"))))());return j(this.#e.defaultImplementationConst,we([this.#e.methodParameter,this.#e.pathParameter,this.#e.paramsArgument],i.createBlock([s,a,n,c,m,p,l]),{isAsync:!0}),{type:this.#e.implementationType})};#n=()=>rr(Ue({request:"K",params:_(this.interfaces.input,"K")}),[j(sr(this.#e.pathParameter,this.#e.restConst),A(this.#e.substituteFn)(i.createElementAccessExpression(A(this.#e.parseRequestFn)(this.#e.requestParameter),E(1)),this.#e.paramsArgument)),j(this.#e.searchParamsConst,this.#r(this.#e.restConst)),mr(i.createPropertyAccessExpression(i.createThis(),this.#e.sourceProp),He("EventSource",this.#o()))]);#s=t=>i.createTypeLiteralNode([Pe(w("event"),t)]);#i=()=>ar(this.#e.onMethod,Ue({[this.#e.eventParameter.text]:"E",[this.#e.handlerParameter.text]:lr({[this.#e.dataParameter.text]:_(Et("R",nr(this.#s("E"))),D(w("data")))},Uo(X.SyntaxKind.VoidKeyword))}),[i.createExpressionStatement(A(i.createThis(),this.#e.sourceProp,w("addEventListener"))(this.#e.eventParameter,we([this.#e.msgParameter],A(this.#e.handlerParameter)(A(JSON[Symbol.toStringTag],w("parse"))(i.createPropertyAccessExpression(i.createParenthesizedExpression(i.createAsExpression(this.#e.msgParameter,f(MessageEvent.name))),w("data"))))))),i.createReturnStatement(i.createThis())],{typeParams:{E:_("R",D(w("event")))}});makeSubscriptionClass=t=>pr(t,[Lo(this.#e.sourceProp,"EventSource"),this.#n(),this.#i()],{typeParams:{K:Et(this.requestType.name,i.createTemplateLiteralType(i.createTemplateHead("get "),[i.createTemplateLiteralTypeSpan(f(X.SyntaxKind.StringKeyword),i.createTemplateTail(""))])),R:Et(_(this.interfaces.positive,"K"),nr(this.#s(X.SyntaxKind.StringKeyword)))}});makeUsageStatements=(t,r)=>[j(this.#e.clientConst,He(t)),A(this.#e.clientConst,this.#e.provideMethod)(E("get /v1/user/retrieve"),i.createObjectLiteralExpression([i.createPropertyAssignment("id",E("10"))])),A(He(r,E("get /v1/events/stream"),i.createObjectLiteralExpression()),this.#e.onMethod)(E("time"),we(["time"],i.createBlock([])))]};import*as I from"ramda";import x from"typescript";import{z as fr}from"zod";var{factory:F}=x,Ds={[x.SyntaxKind.AnyKeyword]:"",[x.SyntaxKind.BigIntKeyword]:BigInt(0),[x.SyntaxKind.BooleanKeyword]:!1,[x.SyntaxKind.NumberKeyword]:0,[x.SyntaxKind.ObjectKeyword]:{},[x.SyntaxKind.StringKeyword]:"",[x.SyntaxKind.UndefinedKeyword]:void 0},ur={name:I.path(["name","text"]),type:I.path(["type"]),optional:I.path(["questionToken"])},Ks=({value:e})=>D(e),Fs=({shape:e},{isResponse:t,next:r,optionalPropStyle:{withQuestionMark:o}})=>{let n=Object.entries(e).map(([s,a])=>{let{description:c,_def:m}=a,p=t?a instanceof fr.ZodOptional:a.isOptional();return Pe(s,r(a),{comment:c,isOptional:p&&o,isDeprecated:m[y]?.isDeprecated})});return F.createTypeLiteralNode(n)},qs=({element:e},{next:t})=>F.createArrayTypeNode(t(e)),Bs=({options:e})=>F.createUnionTypeNode(e.map(D)),Ko=({options:e},{next:t})=>{let r=new Map;for(let o of e){let n=t(o);r.set(Ho(n)?n.kind:n,n)}return F.createUnionTypeNode(Array.from(r.values()))},$s=e=>Ds?.[e.kind],_s=(e,{next:t,isResponse:r})=>{let o=t(e.innerType());if(r&&e._def.effect.type==="transform"){let n=st(e,$s(o)),s={number:x.SyntaxKind.NumberKeyword,bigint:x.SyntaxKind.BigIntKeyword,boolean:x.SyntaxKind.BooleanKeyword,string:x.SyntaxKind.StringKeyword,undefined:x.SyntaxKind.UndefinedKeyword,object:x.SyntaxKind.ObjectKeyword};return f(n&&s[n]||x.SyntaxKind.AnyKeyword)}return o},Vs=e=>F.createUnionTypeNode(Object.values(e.enum).map(D)),Gs=(e,{next:t,optionalPropStyle:{withUndefined:r}})=>{let o=t(e.unwrap());return r?F.createUnionTypeNode([o,f(x.SyntaxKind.UndefinedKeyword)]):o},Js=(e,{next:t})=>F.createUnionTypeNode([t(e.unwrap()),D(null)]),Ws=({items:e,_def:{rest:t}},{next:r})=>F.createTupleTypeNode(e.map(r).concat(t===null?[]:F.createRestTypeNode(r(t)))),Ys=({keySchema:e,valueSchema:t},{next:r})=>f("Record",[e,t].map(r)),Qs=I.tryCatch(e=>{if(!e.every(x.isTypeLiteralNode))throw new Error("Not objects");let t=I.chain(I.prop("members"),e),r=I.uniqWith((...o)=>{if(!I.eqBy(ur.name,...o))return!1;if(I.both(I.eqBy(ur.type),I.eqBy(ur.optional))(...o))return!0;throw new Error("Has conflicting prop")},t);return F.createTypeLiteralNode(r)},(e,t)=>F.createIntersectionTypeNode(t)),Xs=({_def:{left:e,right:t}},{next:r})=>Qs([e,t].map(r)),ei=({_def:e},{next:t})=>t(e.innerType),ae=e=>()=>f(e),ti=(e,{next:t})=>t(e.unwrap()),ri=(e,{next:t})=>t(e.unwrap()),oi=({_def:e},{next:t})=>t(e.innerType),ni=({_def:e},{next:t,isResponse:r})=>t(e[r?"out":"in"]),si=()=>D(null),ii=(e,{makeAlias:t,next:r})=>t(e,()=>r(e.schema)),ai=e=>{let t=e.unwrap(),r=f(x.SyntaxKind.StringKeyword),o=f("Buffer"),n=F.createUnionTypeNode([r,o]);return t instanceof fr.ZodString?r:t instanceof fr.ZodUnion?n:o},pi=(e,{next:t})=>t(e.unwrap().shape.raw),ci={ZodString:ae(x.SyntaxKind.StringKeyword),ZodNumber:ae(x.SyntaxKind.NumberKeyword),ZodBigInt:ae(x.SyntaxKind.BigIntKeyword),ZodBoolean:ae(x.SyntaxKind.BooleanKeyword),ZodAny:ae(x.SyntaxKind.AnyKeyword),ZodUndefined:ae(x.SyntaxKind.UndefinedKeyword),[ge]:ae(x.SyntaxKind.StringKeyword),[he]:ae(x.SyntaxKind.StringKeyword),ZodNull:si,ZodArray:qs,ZodTuple:Ws,ZodRecord:Ys,ZodObject:Fs,ZodLiteral:Ks,ZodIntersection:Xs,ZodUnion:Ko,ZodDefault:ei,ZodEnum:Bs,ZodNativeEnum:Vs,ZodEffects:_s,ZodOptional:Gs,ZodNullable:Js,ZodDiscriminatedUnion:Ko,ZodBranded:ti,ZodCatch:oi,ZodPipeline:ni,ZodLazy:ii,ZodReadonly:ri,[G]:ai,[ie]:pi},yr=(e,{brandHandling:t,ctx:r})=>Oe(e,{rules:{...t,...ci},onMissing:()=>f(x.SyntaxKind.AnyKeyword),ctx:r});var gr=class extends zt{#e=[this.someOfType];#t=new Map;#r=[];#o(t,r){let o=this.#t.get(t)?.name?.text;if(!o){o=`Type${this.#t.size+1}`;let n=D(null);this.#t.set(t,Q(o,n)),this.#t.set(t,Q(o,r()))}return f(o)}constructor({routing:t,brandHandling:r,variant:o="client",clientClassName:n="Client",subscriptionClassName:s="Subscription",serverUrl:a="https://example.com",optionalPropStyle:c={withQuestionMark:!0,withUndefined:!0},noContent:m=di.undefined()}){super(a);let p={makeAlias:this.#o.bind(this),optionalPropStyle:c},l={brandHandling:r,ctx:{...p,isResponse:!1}},h={brandHandling:r,ctx:{...p,isResponse:!0}};Le({routing:t,onEndpoint:(S,b,k)=>{let P=se.bind(null,k,b),{isDeprecated:V,inputSchema:M,tags:R}=S,z=`${k} ${b}`,C=Q(P("input"),yr(M,l),{comment:z});this.#e.push(C);let L=Ce.reduce((v,pe)=>{let Qe=S.getResponses(pe),It=Fo.chain(([vt,{schema:te,mimeTypes:ce,statusCodes:kt}])=>{let et=Q(P(pe,"variant",`${vt+1}`),yr(ce?te:m,h),{comment:z});return this.#e.push(et),kt.map(tt=>Pe(tt,et.name))},Array.from(Qe.entries())),Xe=At(P(pe,"response","variants"),It,{comment:z});return this.#e.push(Xe),Object.assign(v,{[pe]:Xe})},{});this.paths.add(b);let O=D(z),q={input:f(C.name),positive:this.someOf(L.positive),negative:this.someOf(L.negative),response:i.createUnionTypeNode([_(this.interfaces.positive,O),_(this.interfaces.negative,O)]),encoded:i.createIntersectionTypeNode([f(L.positive.name),f(L.negative.name)])};this.registry.set(z,{isDeprecated:V,store:q}),this.tags.set(z,R)}}),this.#e.unshift(...this.#t.values()),this.#e.push(this.makePathType(),this.methodType,...this.makePublicInterfaces(),this.requestType),o!=="types"&&(this.#e.push(this.makeEndpointTags(),this.makeParseRequestFn(),this.makeSubstituteFn(),this.makeImplementationType(),this.makeDefaultImplementation(),this.makeClientClass(n),this.makeSubscriptionClass(s)),this.#r.push(...this.makeUsageStatements(n,s)))}#n(t){return this.#r.length?this.#r.map(r=>typeof r=="string"?r:er(r,t)).join(`
`):void 0}print(t){let r=this.#n(t),o=r&&Zt.addSyntheticLeadingComment(Zt.addSyntheticLeadingComment(i.createEmptyStatement(),Zt.SyntaxKind.SingleLineCommentTrivia," Usage example:"),Zt.SyntaxKind.MultiLineCommentTrivia,`
${r}`);return this.#e.concat(o||[]).map((n,s)=>er(n,s<this.#e.length?t:{...t,omitTrailingSemicolon:!0})).join(`

`)}async printFormatted({printerOptions:t,format:r}={}){let o=r;if(!o)try{let a=(await Me("prettier")).format;o=c=>a(c,{filepath:"client.ts"})}catch{}let n=this.#n(t);this.#r=n&&o?[await o(n)]:this.#r;let s=this.print(t);return o?o(s):s}};import{z as De}from"zod";var Bo=(e,t)=>De.object({data:t,event:De.literal(e),id:De.string().optional(),retry:De.number().int().positive().optional()}),mi=(e,t,r)=>Bo(String(t),e[t]).transform(o=>[`event: ${o.event}`,`data: ${JSON.stringify(o.data)}`,"",""].join(`
`)).parse({event:t,data:r}),li=1e4,qo=e=>e.headersSent||e.writeHead(200,{connection:"keep-alive","content-type":Z.sse,"cache-control":"no-cache"}),ui=e=>new J({handler:async({response:t})=>setTimeout(()=>qo(t),li)&&{isClosed:()=>t.writableEnded||t.closed,emit:(r,o)=>{qo(t),t.write(mi(e,r,o),"utf-8"),t.flush?.()}}}),fi=e=>new Se({positive:()=>{let[t,...r]=Object.entries(e).map(([o,n])=>Bo(o,n));return{mimeType:Z.sse,schema:r.length?De.discriminatedUnion("event",[t,...r]):t}},negative:{mimeType:"text/plain",schema:De.string()},handler:async({response:t,error:r,logger:o,request:n,input:s})=>{if(r){let a=ze(r);$e(a,o,n,s),t.headersSent||t.status(a.statusCode).type("text/plain").write(be(a),"utf-8")}t.end()}}),hr=class extends Te{constructor(t){super(fi(t)),this.middlewares=[ui(t)]}};var yi={dateIn:Sr,dateOut:Rr,form:Pr,file:ct,upload:Er,raw:Ar};export{Ve as BuiltinLogger,Ge as DependsOnMethod,Qt as Documentation,B as DocumentationError,Te as EndpointsFactory,hr as EventStreamFactory,ee as InputValidationError,gr as Integration,J as Middleware,Ke as MissingPeerError,me as OutputValidationError,Se as ResultHandler,de as RoutingError,Je as ServeStatic,mn as arrayEndpointsFactory,Kt as arrayResultHandler,jn as attachRouting,Xo as createConfig,Nn as createServer,dn as defaultEndpointsFactory,Re as defaultResultHandler,ze as ensureHttpError,yi as ez,ne as getExamples,le as getMessageFromError,Ns as testEndpoint,Ms as testMiddleware};
